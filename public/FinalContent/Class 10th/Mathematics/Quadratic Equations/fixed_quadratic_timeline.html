<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quadratic Equations - Mathematical Journey Through Time</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Audio Control */
        #audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(126, 87, 194, 0.9);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            transform: scale(1.1);
            background: rgba(126, 87, 194, 1);
        }

        .control-btn.muted .unmute-icon { display: none; }
        .control-btn:not(.muted) .mute-icon { display: none; }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3.2rem;
            background: linear-gradient(45deg, #00ff88, #00bbff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Main Animation Stage */
        .animation-stage {
            background: linear-gradient(to bottom, #1a1a2e 0%, #16213e 100%);
            border-radius: 25px;
            height: 600px;
            position: relative;
            margin: 40px 0;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            border: 4px solid rgba(0, 255, 136, 0.4);
        }

        /* Grid Background */
        .grid-background {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.3;
        }

        /* Content Container inside stage */
        .stage-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        /* Animation Scenes */
        .animation-scene {
            display: none;
            opacity: 0;
            transition: opacity 1s ease;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            padding: 40px;
        }

        .animation-scene.visible {
            display: flex;
            opacity: 1;
            align-items: center;
            justify-content: center;
        }

        /* Welcome Scene */
        .welcome-scene {
            text-align: center;
        }

        .welcome-title {
            font-size: 2.5rem;
            color: #00ff88;
            margin-bottom: 20px;
            animation: titleGlow 2s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 10px rgba(0, 255, 136, 0.5); }
            50% { text-shadow: 0 0 20px rgba(0, 255, 136, 0.8); }
        }

        /* Polynomial Scene */
        .polynomial-content {
            text-align: center;
            max-width: 700px;
            margin: 0 auto;
        }

        .polynomial-display {
            font-size: 3rem;
            color: #00ff88;
            margin: 30px 0;
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
            animation: polynomialPulse 2s ease infinite;
        }

        @keyframes polynomialPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .term {
            display: inline-block;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .term.x-squared { color: #ff69b4; }
        .term.x-term { color: #00bbff; }
        .term.constant { color: #ffd700; }

        .coefficient-slider {
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .slider {
            width: 200px;
            height: 8px;
            appearance: none;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            background: #00ff88;
            border-radius: 50%;
            cursor: pointer;
        }

        /* Prayer Hall Scene */
        .prayer-hall-content {
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
            text-align: center;
        }

        .hall-visualization {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 105, 180, 0.2));
            border: 3px solid rgba(255, 215, 0, 0.5);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            position: relative;
            height: 300px;
        }

        .hall-diagram {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hall-rect {
            border: 3px solid #00ff88;
            position: absolute;
            transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(0, 255, 136, 0.1);
        }

        .hall-rect.original {
            border-style: dashed;
            background: rgba(0, 255, 136, 0.05);
            z-index: 1;
        }

        .hall-rect.expanded {
            border-style: solid;
            background: rgba(0, 187, 255, 0.1);
            z-index: 2;
            box-shadow: 0 0 30px rgba(0, 187, 255, 0.3);
        }

        .dimension-label {
            position: absolute;
            font-size: 1.1rem;
            color: #ffff00;
            font-weight: bold;
            padding: 3px 8px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            transition: all 0.5s ease;
        }

        .width-label {
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
        }

        .length-label {
            right: -90px;
            top: 50%;
            transform: translateY(-50%);
        }

        .area-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.3rem;
            color: #00ff88;
            font-weight: bold;
            z-index: 3;
        }

        .expansion-arrow {
            position: absolute;
            color: #ff69b4;
            font-size: 1.5rem;
            opacity: 0;
            animation: arrowPulse 1s ease infinite;
        }

        @keyframes arrowPulse {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .arrow-right {
            right: -50px;
            top: 50%;
            transform: translateY(-50%);
        }

        .arrow-bottom {
            bottom: -50px;
            left: 50%;
            transform: translateX(-50%);
        }

        /* History Timeline Scene */
        .timeline-scene-container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            height: 400px;
            padding: 0 20px;
        }

        .timeline-line {
            position: absolute;
            top: 50%;
            left: 5%;
            right: 5%;
            height: 4px;
            background: linear-gradient(to right, #00ff88, #00bbff, #ff00ff);
            transform: translateY(-50%);
            border-radius: 2px;
        }

        .timeline-item {
            position: absolute;
            top: 50%;
            transform: translateX(-50%) translateY(-50%);
            opacity: 0;
            animation: timelineAppear 0.8s ease forwards;
            z-index: 10;
        }

        /* FIXED: Better spacing for all 5 timeline items */
        .timeline-item:nth-child(1) { left: 8%; animation-delay: 0.3s; }
        .timeline-item:nth-child(2) { left: 26%; animation-delay: 0.6s; }
        .timeline-item:nth-child(3) { left: 44%; animation-delay: 0.9s; }
        .timeline-item:nth-child(4) { left: 62%; animation-delay: 1.2s; }
        .timeline-item:nth-child(5) { left: 80%; animation-delay: 1.5s; }

        @keyframes timelineAppear {
            from { 
                opacity: 0; 
                transform: translateX(-50%) translateY(-50%) scale(0.5);
            }
            to { 
                opacity: 1; 
                transform: translateX(-50%) translateY(-50%) scale(1);
            }
        }

        .timeline-dot {
            width: 24px;
            height: 24px;
            background: #00ff88;
            border-radius: 50%;
            margin: 0 auto 10px auto;
            box-shadow: 0 0 25px rgba(0, 255, 136, 0.7);
            border: 3px solid #ffffff;
            transition: all 0.3s ease;
        }

        .timeline-dot:hover {
            transform: scale(1.2);
            box-shadow: 0 0 35px rgba(0, 255, 136, 1);
        }

        .timeline-info {
            position: relative;
            background: rgba(0, 0, 0, 0.85);
            padding: 12px 16px;
            border-radius: 12px;
            white-space: nowrap;
            font-size: 0.85rem;
            min-width: 120px;
            text-align: center;
            border: 2px solid rgba(0, 255, 136, 0.3);
            backdrop-filter: blur(10px);
        }

        /* Alternate positioning - some above, some below */
        .timeline-item:nth-child(odd) .timeline-info {
            margin-top: 15px;
        }

        .timeline-item:nth-child(even) .timeline-info {
            margin-bottom: 15px;
            transform: translateY(-100%);
        }

        .timeline-date {
            color: #ffd700;
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .timeline-name {
            color: #00bbff;
        }

        /* Equation Solving Scene */
        .solving-content {
            max-width: 700px;
            margin: 0 auto;
            text-align: center;
        }

        .equation-step {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 187, 255, 0.1));
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            font-size: 1.5rem;
            font-family: 'Courier New', monospace;
            opacity: 0;
            transform: translateY(20px);
            animation: stepSlide 0.5s ease forwards;
        }

        .equation-step:nth-child(2) { animation-delay: 0.3s; }
        .equation-step:nth-child(3) { animation-delay: 0.6s; }
        .equation-step:nth-child(4) { animation-delay: 0.9s; }

        @keyframes stepSlide {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Graph Scene */
        .graph-content {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Formula Box */
        .formula-box {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 105, 180, 0.2));
            border: 3px solid rgba(255, 215, 0, 0.5);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
            transform: scale(0);
            animation: formulaPop 0.5s ease forwards;
        }

        @keyframes formulaPop {
            to { transform: scale(1); }
        }

        .formula-title {
            font-size: 1.6rem;
            color: #ffd700;
            margin-bottom: 20px;
        }

        .quadratic-formula {
            font-size: 2rem;
            color: #00ff88;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
        }

        /* Solution Display */
        .solution-display {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }

        .solution-value {
            font-size: 1.8rem;
            color: #ff69b4;
            font-weight: bold;
            margin: 10px 0;
        }

        /* Info Display */
        .info-display {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 15px 20px;
            text-align: center;
            font-size: 1.1rem;
            opacity: 0;
            transition: opacity 0.5s ease;
            backdrop-filter: blur(10px);
        }

        .info-display.visible {
            opacity: 1;
        }

        /* Controls */
        .controls {
            text-align: center;
            margin: 40px 0;
        }

        .controls-title {
            font-size: 2rem;
            margin-bottom: 25px;
            color: #00ff88;
            font-weight: 600;
        }

        .demo-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .demo-btn {
            background: linear-gradient(135deg, #764ba2, #667eea);
            border: none;
            color: white;
            padding: 16px 28px;
            border-radius: 35px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(118, 75, 162, 0.3);
            min-width: 180px;
        }

        .demo-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(118, 75, 162, 0.4);
        }

        .demo-btn.active {
            background: linear-gradient(135deg, #00ff88, #00bbff);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.4);
        }

        /* Analysis Panel */
        .analysis {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 25px;
            padding: 35px;
            margin: 35px 0;
            border: 3px solid rgba(0, 255, 136, 0.4);
            backdrop-filter: blur(15px);
        }

        .analysis-title {
            font-size: 1.6rem;
            color: #00ff88;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 600;
        }

        .analysis-content {
            font-size: 1.2rem;
            line-height: 1.8;
            text-align: center;
            color: #e2e8f0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.2rem;
            }
            
            .animation-stage {
                height: 500px;
            }
            
            .demo-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .polynomial-display {
                font-size: 2rem;
            }
            
            /* Better mobile timeline spacing and sizing */
            .timeline-scene-container {
                padding: 0 10px;
                max-width: 100%;
            }
            
            .timeline-item {
                font-size: 0.75rem;
            }
            
            .timeline-item:nth-child(1) { left: 10%; }
            .timeline-item:nth-child(2) { left: 22%; }
            .timeline-item:nth-child(3) { left: 38%; }
            .timeline-item:nth-child(4) { left: 60%; }
            .timeline-item:nth-child(5) { left: 80%; }
            
            .timeline-dot {
                width: 18px;
                height: 18px;
            }
            
            .timeline-info {
                font-size: 0.7rem;
                padding: 8px 12px;
                min-width: 100px;
            }
            
            .timeline-line {
                left: 8%;
                right: 8%;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Control -->
    <div id="audio-control">
        <button id="mute-btn" class="control-btn">
            <span class="unmute-icon">üîä</span>
            <span class="mute-icon">üîá</span>
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Quadratic Equations</h1>
            <p>Journey through mathematical history and master the art of solving quadratic equations!</p>
        </div>

        <!-- Main Animation Stage -->
        <div class="animation-stage" id="animation-stage">
            <div class="grid-background"></div>
            
            <!-- Stage Content Container -->
            <div class="stage-content">
                <!-- Welcome Scene -->
                <div class="animation-scene visible" id="welcome-scene">
                    <div class="welcome-scene">
                        <h2 class="welcome-title">Welcome to Quadratic Equations!</h2>
                        <p style="font-size: 1.3rem; color: #00bbff;">
                            Discover the power of second-degree polynomials<br>
                            and their applications through history
                        </p>
                    </div>
                </div>

                <!-- Polynomial Introduction Scene -->
                <div class="animation-scene" id="polynomial-scene">
                    <div class="polynomial-content">
                        <h2 style="font-size: 2rem; color: #00ff88; margin-bottom: 20px;">
                            The Quadratic Polynomial
                        </h2>
                        <div class="polynomial-display">
                            <span class="term x-squared">ax¬≤</span>
                            <span class="term">+</span>
                            <span class="term x-term">bx</span>
                            <span class="term">+</span>
                            <span class="term constant">c</span>
                        </div>
                        <p style="font-size: 1.3rem; margin-top: 30px; color: #ffff00;">
                            Where a ‚â† 0
                        </p>
                        <p style="font-size: 1.1rem; margin-top: 20px;">
                            When we set this polynomial equal to zero,<br>
                            we get a <strong style="color: #00ff88;">quadratic equation</strong>!
                        </p>
                    </div>
                </div>

                <!-- Prayer Hall Problem Scene -->
                <div class="animation-scene" id="prayer-hall-scene">
                    <div class="prayer-hall-content">
                        <h2 style="font-size: 2rem; color: #ffd700; margin-bottom: 20px;">
                            üèõÔ∏è The Prayer Hall Problem
                        </h2>
                        <div class="hall-visualization">
                            <div class="hall-diagram">
                                <!-- Original Rectangle -->
                                <div class="hall-rect original" id="hall-original" style="width: 160px; height: 120px;">
                                    <div class="dimension-label width-label" id="orig-width">20 m</div>
                                    <div class="dimension-label length-label" id="orig-length">15 m</div>
                                    <div class="area-display" id="orig-area">300 m¬≤</div>
                                </div>
                                <!-- Expanded Rectangle (initially hidden) -->
                                <div class="hall-rect expanded" id="hall-expanded" style="width: 160px; height: 120px; opacity: 0;">
                                    <div class="dimension-label width-label" id="exp-width" style="opacity: 0;">20+x</div>
                                    <div class="dimension-label length-label" id="exp-length" style="opacity: 0;">15+2x</div>
                                    <div class="area-display" id="exp-area" style="opacity: 0;">?</div>
                                </div>
                                <!-- Expansion Arrows (initially hidden) -->
                                <div class="expansion-arrow arrow-right" id="arrow-right" style="opacity: 0;">‚Üí</div>
                                <div class="expansion-arrow arrow-bottom" id="arrow-bottom" style="opacity: 0;">‚Üì</div>
                            </div>
                        </div>
                        <div id="equation-formation" style="margin-top: 30px; min-height: 120px;">
                            <p style="font-size: 1.2rem; color: #00bbff;">
                                Original Area = 300 m¬≤
                            </p>
                            <p style="font-size: 1.1rem; margin-top: 10px; opacity: 0;" id="expansion-text">
                                Expand: width by x, length by 2x
                            </p>
                            <p style="font-size: 1.2rem; color: #ffff00; margin-top: 15px; font-family: 'Courier New', monospace; opacity: 0;" id="new-area-eq">
                                New Area = (20+x)(15+2x) = 300
                            </p>
                            <p style="font-size: 1.3rem; color: #00ff88; margin-top: 15px; font-family: 'Courier New', monospace; opacity: 0;" id="final-equation">
                                2x¬≤ + 55x + 300 = 300
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Solving Steps Scene -->
                <div class="animation-scene" id="solving-steps-scene">
                    <div class="solving-content" style="position: relative; height: 100%;">
                        <h2 style="font-size: 1.8rem; color: #00ff88; margin-bottom: 15px; position: absolute; top: 10px; left: 50%; transform: translateX(-50%); text-align: center; width: 100%;">
                            üìù Solving Step by Step
                        </h2>
                        <div id="step-container" style="min-height: 400px; padding-top: 80px;">
                            <!-- All steps will be dynamically shown one by one -->
                        </div>
                    </div>
                </div>

                <!-- History Timeline Scene -->
                <div class="animation-scene" id="timeline-scene">
                    <div class="timeline-scene-container">
                        <h2 style="font-size: 2rem; color: #00ff88; text-align: center; margin-bottom: 30px;">
                            üìú Historical Journey
                        </h2>
                        <div class="timeline-line"></div>
                        
                        <!-- Position 1 (8%): Babylonians - Earliest -->
                        <div class="timeline-item">
                            <div class="timeline-dot"></div>
                            <div class="timeline-info">
                                <span class="timeline-date">2000 BCE</span><br>
                                <span class="timeline-name">Babylonians</span>
                            </div>
                        </div>
                        
                        <!-- Position 2 (26%): Euclid -->
                        <div class="timeline-item">
                            <div class="timeline-dot"></div>
                            <div class="timeline-info">
                                <span class="timeline-date">300 BCE</span><br>
                                <span class="timeline-name">Euclid</span>
                            </div>
                        </div>
                        
                        <!-- Position 3 (44%): Brahmagupta -->
                        <div class="timeline-item">
                            <div class="timeline-dot"></div>
                            <div class="timeline-info">
                                <span class="timeline-date">628 CE</span><br>
                                <span class="timeline-name">Brahmagupta</span>
                            </div>
                        </div>
                        
                        <!-- Position 4 (62%): Al-Khwarizmi -->
                        <div class="timeline-item">
                            <div class="timeline-dot"></div>
                            <div class="timeline-info">
                                <span class="timeline-date">820 CE</span><br>
                                <span class="timeline-name">Al-Khwarizmi</span>
                            </div>
                        </div>
                        
                        <!-- Position 5 (80%): Sridharacharya - Latest -->
                        <div class="timeline-item">
                            <div class="timeline-dot"></div>
                            <div class="timeline-info">
                                <span class="timeline-date">870 CE</span><br>
                                <span class="timeline-name">Sridharacharya</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Equation Solving Scene -->
                <div class="animation-scene" id="solving-scene">
                    <div class="solving-content">
                        <h2 style="font-size: 2rem; color: #00ff88; margin-bottom: 30px;">
                            Solving Our Equation
                        </h2>
                        <div class="equation-step">
                            2x¬≤ + x - 300 = 0
                        </div>
                        <div class="equation-step">
                            Using the quadratic formula:
                        </div>
                        <div class="equation-step" style="color: #ffd700;">
                            x = (-b ¬± ‚àö(b¬≤ - 4ac)) / 2a
                        </div>
                        <div class="equation-step">
                            x = 12 or x = -12.5
                        </div>
                    </div>
                </div>

                <!-- Graph Visualization Scene -->
                <div class="animation-scene" id="graph-scene">
                    <div class="graph-content">
                        <canvas id="parabola-canvas" style="width: 100%; max-width: 500px; height: 400px; background: rgba(22, 33, 62, 0.9); border-radius: 10px;"></canvas>
                        <div style="margin-top: 15px; text-align: center; font-size: 1rem;">
                            <span style="color: #00ff88; font-weight: bold;">Parabola: y = 2x¬≤ + x - 300</span>
                        </div>
                    </div>
                </div>

                <!-- Formula Scene -->
                <div class="animation-scene" id="formula-scene">
                    <div class="formula-box">
                        <div class="formula-title">‚ú® The Quadratic Formula</div>
                        <div class="quadratic-formula">
                            x = (-b ¬± ‚àö(b¬≤ - 4ac)) / 2a
                        </div>
                        <div style="margin-top: 30px;">
                            <p style="font-size: 1.2rem; color: #00bbff;">
                                This universal formula can solve<br>
                                ANY quadratic equation!
                            </p>
                        </div>
                        <div class="solution-display">
                            <p style="color: #ffd700; margin-bottom: 10px;">For our prayer hall problem:</p>
                            <div class="solution-value">x‚ÇÅ = 12 meters</div>
                            <div class="solution-value">x‚ÇÇ = -12.5 (not valid)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Info Display -->
            <div class="info-display visible" id="info-display">
                Click any button below to start exploring!
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-title" id="lesson-title">Choose Your Learning Path</div>
            
            <div class="demo-buttons">
                <button class="demo-btn" onclick="playCompleteStory()">üìö Complete Lesson</button>
                <button class="demo-btn" onclick="showPolynomial()">üî¢ Polynomial Form</button>
                <button class="demo-btn" onclick="showPrayerHall()">üèõÔ∏è Prayer Hall Problem</button>
                <button class="demo-btn" onclick="showHistory()">üìú Historical Timeline</button>
                <button class="demo-btn" onclick="showFormula()">‚ú® Quadratic Formula</button>
                <button class="demo-btn" onclick="showGraph()">üìä Graph Visualization</button>
                <button class="demo-btn" onclick="resetAll()">üîÑ Reset</button>
            </div>
        </div>

        <!-- Analysis Panel -->
        <div class="analysis">
            <div class="analysis-title">üìä Understanding Quadratic Equations</div>
            <div class="analysis-content" id="analysis-content">
                Quadratic equations appear everywhere in nature and human constructions - from the path of thrown objects to architectural designs. 
                Select a demonstration above to begin your mathematical journey through history!
            </div>
        </div>
    </div>

    <script>
        // Voice System
        class QuadraticNarrator {
            constructor() {
                this.isEnabled = globalAudioEnabled;
                this.currentUtterance = null;
                this.settings = { rate: 0.95, pitch: 1.0, volume: 0.85 };
                this.isDestroyed = false;
            }

            async speak(text, delay = 0) {
                if (!this.isEnabled || !text || this.isDestroyed) return;
                
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (this.isDestroyed) {
                            resolve();
                            return;
                        }
                        this.stop();
                        const utterance = new SpeechSynthesisUtterance(text);
                        Object.assign(utterance, this.settings);
                        
                        utterance.onend = resolve;
                        utterance.onerror = resolve;
                        
                        this.currentUtterance = utterance;
                        speechSynthesis.speak(utterance);
                    }, delay);
                });
            }

            stop() {
                speechSynthesis.cancel();
                this.currentUtterance = null;
            }

            destroy() {
                this.isDestroyed = true;
                this.stop();
                this.currentUtterance = null;
                this.settings = null;
            }
        }

        // Global state management
        let globalAudioEnabled = true;
        let currentNarrator = null;
        let isPlaying = false;
        let currentDemoAborted = false;
        let currentTaskId = null;
        let animationTimeouts = [];
        let currentChart = null;

        // Function to stop current demo
        function stopCurrentDemo() {
            currentDemoAborted = true;
            currentTaskId = null;
            
            if (currentNarrator) {
                currentNarrator.destroy();
                currentNarrator = null;
            }
            
            animationTimeouts.forEach(timeout => clearTimeout(timeout));
            animationTimeouts = [];
            
            document.querySelectorAll('.animation-scene').forEach(scene => {
                scene.classList.remove('visible');
            });
            
            updateInfo("Click any button below to start exploring!");
            isPlaying = false;
        }

        function shouldContinue(taskId = null) {
            if (taskId && currentTaskId && taskId !== currentTaskId) {
                return false;
            }
            return !currentDemoAborted;
        }

        function createNewNarrator(taskId = null) {
            if (currentNarrator) {
                currentNarrator.destroy();
                currentNarrator = null;
            }
            currentDemoAborted = false;
            currentTaskId = taskId;
            currentNarrator = new QuadraticNarrator();
            return currentNarrator;
        }

        function switchToScene(sceneId, taskId = null) {
            if (!shouldContinue(taskId)) return;
            
            document.querySelectorAll('.animation-scene').forEach(scene => {
                scene.classList.remove('visible');
            });
            
            const timeout = setTimeout(() => {
                if (!shouldContinue(taskId)) return;
                const scene = document.getElementById(sceneId);
                if (scene) {
                    scene.classList.add('visible');
                }
            }, 300);
            
            animationTimeouts.push(timeout);
        }

        // Initialize
        window.addEventListener('load', () => {
            document.getElementById('welcome-scene').classList.add('visible');
            const narrator = createNewNarrator('initialization');
            narrator.speak("Welcome to Quadratic Equations! Let's explore the fascinating world of second-degree polynomials and their rich history.");
            updateInfo("Click any button below to start exploring!");
        });

        // Complete Story
        async function playCompleteStory() {
            const taskId = 'complete-story';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(0);
            
            const narrator = createNewNarrator(taskId);
            
            await resetAll();
            if (!shouldContinue(taskId)) return;
            
            updateTitle("üìö Complete Quadratic Equations Journey");
            updateInfo("Starting comprehensive lesson...");
            updateAnalysis("Beginning our journey through quadratic equations, from ancient Babylon to modern applications...");
            
            await narrator.speak("Welcome to the complete lesson on quadratic equations! We'll explore their structure, history, and real-world applications.");
            await wait(2000);
            if (!shouldContinue(taskId)) return;
            
            // Part 1: Polynomial Introduction
            updateInfo("Part 1: Understanding the Quadratic Polynomial");
            switchToScene('polynomial-scene', taskId);
            await wait(500);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("A quadratic polynomial has the form a x squared plus b x plus c, where a cannot be zero.");
            await wait(3000);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("When we set this polynomial equal to zero, we create a quadratic equation!");
            await wait(2500);
            if (!shouldContinue(taskId)) return;
            
            // Part 2: Prayer Hall Problem
            updateInfo("Part 2: Real-World Application - Prayer Hall");
            switchToScene('prayer-hall-scene', taskId);
            await wait(500);
            if (!shouldContinue(taskId)) return;
            
            // Reset hall first
            resetHall();
            await wait(500);
            
            await narrator.speak("Let's explore a real-world example. A prayer hall has an area of 300 square meters, with width 20 meters and length 15 meters.");
            await wait(4000);
            if (!shouldContinue(taskId)) return;
            
            await animateHallExpansion();
            
            await narrator.speak("If we expand the width by x meters and length by 2x meters, while maintaining the same area, we get an interesting equation.");
            await wait(4000);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("The new dimensions: 20 plus x, times 15 plus 2x, must equal 300.");
            await wait(3000);
            if (!shouldContinue(taskId)) return;
            
            // Show solving steps
            updateInfo("Expanding the equation step by step");
            switchToScene('solving-steps-scene', taskId);
            await wait(500);
            if (!shouldContinue(taskId)) return;
            
            await showSolvingSteps(narrator, taskId);
            
            await narrator.speak("Through expansion and simplification, we arrive at our quadratic equation!");
            await wait(2500);
            if (!shouldContinue(taskId)) return;
            
            // Part 3: Historical Timeline
            updateInfo("Part 3: Historical Journey Through Time");
            switchToScene('timeline-scene', taskId);
            await wait(500);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("Quadratic equations have a rich history spanning over 4000 years!");
            await wait(2500);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("From the Babylonians to Euclid, from Brahmagupta to Al-Khwarizmi, mathematicians across cultures contributed to solving these equations.");
            await wait(4000);
            if (!shouldContinue(taskId)) return;
            
            // Part 4: Solving the Equation
            updateInfo("Part 4: Solving Our Prayer Hall Equation");
            switchToScene('solving-scene', taskId);
            await wait(500);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("Now let's solve our prayer hall equation using the quadratic formula.");
            await wait(2500);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("The quadratic formula: x equals negative b plus or minus square root of b squared minus 4 a c, all divided by 2 a.");
            await wait(3500);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("For our equation, we get x equals 12 meters or negative 12.5. Since distance can't be negative, x equals 12!");
            await wait(3500);
            if (!shouldContinue(taskId)) return;
            
            // Part 5: Graph Visualization
            updateInfo("Part 5: Visualizing the Parabola");
            switchToScene('graph-scene', taskId);
            await wait(500);
            if (!shouldContinue(taskId)) return;
            
            plotParabola();
            
            await narrator.speak("Every quadratic equation forms a parabola when graphed. The x-intercepts are our solutions!");
            await wait(3000);
            if (!shouldContinue(taskId)) return;
            
            // Part 6: The Formula
            updateInfo("Part 6: The Universal Quadratic Formula");
            switchToScene('formula-scene', taskId);
            await wait(500);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("The quadratic formula is universal - it can solve any quadratic equation!");
            await wait(3000);
            if (!shouldContinue(taskId)) return;
            
            updateInfo("Lesson Complete! You've mastered quadratic equations!");
            await narrator.speak("Congratulations! You've learned about quadratic polynomials, their history, real-world applications, and how to solve them!");
            await wait(3500);
            if (!shouldContinue(taskId)) return;
            
            updateAnalysis("Journey complete! You've explored: 1) Quadratic polynomial structure, 2) Real-world applications, 3) 4000 years of mathematical history, 4) The quadratic formula, and 5) Graphical representations.");
            
            await wait(3000);
            if (!shouldContinue(taskId)) return;
            
            document.querySelectorAll('.animation-scene').forEach(scene => {
                scene.classList.remove('visible');
            });
            
            await wait(300);
            if (!shouldContinue(taskId)) return;
            document.getElementById('welcome-scene').classList.add('visible');
            
            updateInfo("Ready to explore individual topics? Try the demos above!");
            isPlaying = false;
        }

        // Show Polynomial
        async function showPolynomial() {
            const taskId = 'polynomial';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(1);
            
            const narrator = createNewNarrator(taskId);
            
            await resetAll();
            if (!shouldContinue(taskId)) return;
            
            updateTitle("üî¢ The Quadratic Polynomial");
            switchToScene('polynomial-scene', taskId);
            updateInfo("Exploring the structure of quadratic polynomials");
            
            await narrator.speak("A quadratic polynomial has three terms: a x squared, the quadratic term; b x, the linear term; and c, the constant term.");
            await wait(4000);
            if (!shouldContinue(taskId)) return;
            
            animatePolynomialTerms();
            
            await narrator.speak("The key requirement is that a cannot equal zero, otherwise it wouldn't be quadratic!");
            
            updateAnalysis("The general form ax¬≤ + bx + c defines all quadratic polynomials. When set equal to zero, it becomes a quadratic equation with up to two solutions.");
            
            isPlaying = false;
        }

        // Show Prayer Hall Problem
        async function showPrayerHall() {
            const taskId = 'prayer-hall';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(2);
            
            const narrator = createNewNarrator(taskId);
            
            await resetAll();
            if (!shouldContinue(taskId)) return;
            
            // Reset the hall to initial state
            resetHall();
            
            updateTitle("üèõÔ∏è The Prayer Hall Problem");
            switchToScene('prayer-hall-scene', taskId);
            updateInfo("A real-world application of quadratic equations");
            
            await wait(500); // Give time for scene to load
            
            await narrator.speak("Let's explore a practical problem. A prayer hall has an area of 300 square meters with width 20 meters and length 15 meters.");
            await wait(3500);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("Now, we want to expand this hall. Let's see what happens when we increase the dimensions.");
            await wait(3000);
            if (!shouldContinue(taskId)) return;
            
            await animateHallExpansion();
            
            await narrator.speak("We increase the width by x meters and the length by 2x meters. The new area must still equal 300 square meters.");
            await wait(4000);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("This gives us the equation: 20 plus x, times 15 plus 2x, equals 300.");
            await wait(3000);
            if (!shouldContinue(taskId)) return;
            
            // Switch to solving steps
            updateInfo("Let's solve this equation step by step!");
            switchToScene('solving-steps-scene', taskId);
            await wait(500);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("Now I'll show you exactly how we expand and simplify this equation.");
            await wait(2000);
            if (!shouldContinue(taskId)) return;
            
            // Show solving steps with narration
            await showSolvingSteps(narrator, taskId);
            
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("This problem shows us that not all mathematical solutions work in real-world contexts. We need to reconsider our problem statement!");
            
            updateAnalysis("The prayer hall problem demonstrates how quadratic equations arise from geometric constraints. The equation 2x¬≤ + 55x = 0 gives x = 0 or x = -27.5. Since we need positive expansion, we realize our problem needs refinement - perhaps we meant to find dimensions that give a different total area!");
            
            isPlaying = false;
        }

        // Show History Timeline
        async function showHistory() {
            const taskId = 'history';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(3);
            
            const narrator = createNewNarrator(taskId);
            
            await resetAll();
            if (!shouldContinue(taskId)) return;
            
            updateTitle("üìú Historical Timeline");
            switchToScene('timeline-scene', taskId);
            updateInfo("4000 years of quadratic equation history");
            
            await narrator.speak("The journey begins with the Babylonians around 2000 BCE, who solved quadratic problems using geometric methods.");
            await wait(3500);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("Euclid formalized geometric solutions, while Indian mathematicians like Brahmagupta and Sridharacharya developed algebraic methods.");
            await wait(4000);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("Al-Khwarizmi, whose name gives us 'algebra', systematized the solutions in the 9th century.");
            
            updateAnalysis("Quadratic equations represent humanity's mathematical evolution - from Babylonian clay tablets to modern computer algorithms, showing how mathematics transcends cultures and time.");
            
            isPlaying = false;
        }

        // Show Formula
        async function showFormula() {
            const taskId = 'formula';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(4);
            
            const narrator = createNewNarrator(taskId);
            
            await resetAll();
            if (!shouldContinue(taskId)) return;
            
            updateTitle("‚ú® The Quadratic Formula");
            switchToScene('formula-scene', taskId);
            updateInfo("The universal solution to all quadratic equations");
            
            await narrator.speak("The quadratic formula is one of mathematics' most elegant results - a single formula that solves any quadratic equation!");
            await wait(3500);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("X equals negative b, plus or minus the square root of b squared minus 4 a c, all divided by 2 a.");
            await wait(3500);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("This formula always works, giving us zero, one, or two real solutions depending on the discriminant.");
            
            updateAnalysis("The quadratic formula encapsulates centuries of mathematical discovery. The discriminant (b¬≤ - 4ac) tells us about the nature of solutions: positive gives two real roots, zero gives one, negative gives complex roots.");
            
            isPlaying = false;
        }

        // Show Graph
        async function showGraph() {
            const taskId = 'graph';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(5);
            
            const narrator = createNewNarrator(taskId);
            
            await resetAll();
            if (!shouldContinue(taskId)) return;
            
            updateTitle("üìä Parabola Visualization");
            switchToScene('graph-scene', taskId);
            updateInfo("Visualizing quadratic equations as parabolas");
            
            await wait(500);
            if (!shouldContinue(taskId)) return;
            
            plotParabola();
            
            await narrator.speak("Every quadratic equation creates a parabola when graphed. The shape tells us everything about the equation!");
            await wait(3500);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("The x-intercepts are our solutions, the vertex shows the maximum or minimum, and the direction depends on the sign of a.");
            
            updateAnalysis("The parabola's geometry reveals the equation's properties: upward for positive a, downward for negative a. The vertex form y = a(x - h)¬≤ + k shows the turning point directly.");
            
            isPlaying = false;
        }

        // Reset
        async function resetAll() {
            if (currentNarrator) currentNarrator.stop();
            
            animationTimeouts.forEach(timeout => clearTimeout(timeout));
            animationTimeouts = [];
            
            document.querySelectorAll('.animation-scene').forEach(scene => {
                scene.classList.remove('visible');
            });
            
            // Reset the prayer hall to initial state
            resetHall();
            
            // Clear the step container
            const stepContainer = document.getElementById('step-container');
            if (stepContainer) {
                stepContainer.innerHTML = '';
            }
            
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
            
            await wait(50);
            document.getElementById('welcome-scene').classList.add('visible');
            
            updateTitle("Choose Your Learning Path");
            updateInfo("Click any button below to start exploring!");
            updateAnalysis("Quadratic equations appear everywhere in nature and human constructions - from the path of thrown objects to architectural designs. Select a demonstration above to begin your mathematical journey through history!");
            
            setActiveButton(-1);
            
            await wait(50);
        }

        // Animation Functions
        function animatePolynomialTerms() {
            const terms = document.querySelectorAll('.term');
            terms.forEach((term, index) => {
                setTimeout(() => {
                    term.style.transform = 'scale(1.3)';
                    setTimeout(() => {
                        term.style.transform = 'scale(1)';
                    }, 300);
                }, index * 200);
            });
        }

        async function animateHallExpansion() {
            const original = document.getElementById('hall-original');
            const expanded = document.getElementById('hall-expanded');
            const arrowRight = document.getElementById('arrow-right');
            const arrowBottom = document.getElementById('arrow-bottom');
            const expansionText = document.getElementById('expansion-text');
            const newAreaEq = document.getElementById('new-area-eq');
            const finalEquation = document.getElementById('final-equation');
            const expWidth = document.getElementById('exp-width');
            const expLength = document.getElementById('exp-length');
            const expArea = document.getElementById('exp-area');
            
            if (!original || !expanded) return;
            
            // Reset everything to initial state first
            original.style.width = '160px';
            original.style.height = '120px';
            expanded.style.width = '160px';
            expanded.style.height = '120px';
            expanded.style.opacity = '0';
            if (arrowRight) arrowRight.style.opacity = '0';
            if (arrowBottom) arrowBottom.style.opacity = '0';
            if (expWidth) expWidth.style.opacity = '0';
            if (expLength) expLength.style.opacity = '0';
            if (expArea) expArea.style.opacity = '0';
            
            await wait(1000);
            
            // Step 2: Show expansion text
            if (expansionText) {
                expansionText.style.opacity = '1';
                expansionText.style.transition = 'opacity 0.5s ease';
            }
            await wait(1500);
            
            // Step 3: Show arrows
            if (arrowRight) {
                arrowRight.style.opacity = '1';
                arrowRight.style.transition = 'opacity 0.5s ease';
            }
            if (arrowBottom) {
                arrowBottom.style.opacity = '1';
                arrowBottom.style.transition = 'opacity 0.5s ease';
            }
            await wait(1000);
            
            // Step 4: Show expanded rectangle and animate its growth
            expanded.style.opacity = '1';
            expanded.style.transition = 'all 1.5s cubic-bezier(0.4, 0, 0.2, 1)';
            
            // Animate the expansion
            setTimeout(() => {
                expanded.style.width = '200px';
                expanded.style.height = '170px';
            }, 100);
            
            // Show new labels
            setTimeout(() => {
                if (expWidth) {
                    expWidth.style.opacity = '1';
                    expWidth.textContent = '20+x';
                }
                if (expLength) {
                    expLength.style.opacity = '1';
                    expLength.textContent = '15+2x';
                }
                if (expArea) {
                    expArea.style.opacity = '1';
                    expArea.textContent = '300 m¬≤';
                }
            }, 800);
            
            await wait(2000);
            
            // Step 5: Show new area equation
            if (newAreaEq) {
                newAreaEq.style.opacity = '1';
                newAreaEq.style.transition = 'opacity 0.5s ease';
            }
            await wait(1500);
            
            // Step 6: Show final equation
            if (finalEquation) {
                finalEquation.style.opacity = '1';
                finalEquation.style.transition = 'opacity 0.5s ease';
                finalEquation.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    finalEquation.style.transform = 'scale(1)';
                }, 500);
            }
        }

        async function showSolvingSteps(narrator, taskId) {
            const container = document.getElementById('step-container');
            if (!container) return;
            
            // Clear container first
            container.innerHTML = '';
            
            const steps = [
                {
                    label: 'Start:',
                    content: '(20+x)(15+2x) = 300',
                    narration: 'We start with the equation: 20 plus x, times 15 plus 2x, equals 300.'
                },
                {
                    label: 'Expand using FOIL:',
                    content: '20√ó15 + 20√ó2x + x√ó15 + x√ó2x = 300',
                    narration: 'Using the FOIL method: First, Outer, Inner, Last terms.'
                },
                {
                    label: 'Calculate:',
                    content: '300 + 40x + 15x + 2x¬≤ = 300',
                    narration: '20 times 15 is 300, 20 times 2x is 40x, x times 15 is 15x, and x times 2x is 2x squared.'
                },
                {
                    label: 'Combine like terms:',
                    content: '300 + 55x + 2x¬≤ = 300',
                    narration: 'Combining 40x and 15x gives us 55x.'
                },
                {
                    label: 'Subtract 300 from both sides:',
                    content: '55x + 2x¬≤ = 0',
                    narration: 'Subtracting 300 from both sides eliminates the constant term.'
                },
                {
                    label: 'Standard form:',
                    content: '2x¬≤ + 55x = 0',
                    narration: 'Rearranging to standard form: 2x squared plus 55x equals zero.',
                    highlight: true
                },
                {
                    label: 'Factor:',
                    content: 'x(2x + 55) = 0',
                    narration: 'We can factor out x: x times 2x plus 55 equals zero.'
                },
                {
                    label: 'Solutions:',
                    content: 'x = 0 or x = -27.5',
                    narration: 'This gives us x equals 0 or x equals negative 27.5. Since we need positive expansion, neither solution works for our physical problem!',
                    highlight: true
                }
            ];
            
            let previousStepDiv = null;
            
            for (let i = 0; i < steps.length; i++) {
                if (!shouldContinue(taskId)) return;
                
                const step = steps[i];
                
                // Fade out the previous-previous step if it exists
                if (previousStepDiv && i > 1) {
                    previousStepDiv.style.opacity = '0';
                    previousStepDiv.style.transform = 'translateY(-20px)';
                    setTimeout(() => {
                        if (previousStepDiv && previousStepDiv.parentNode) {
                            previousStepDiv.remove();
                        }
                    }, 500);
                }
                
                // If there's a previous step (not previous-previous), make it dimmer
                const allSteps = container.querySelectorAll('.equation-step');
                if (allSteps.length > 0) {
                    const lastStep = allSteps[allSteps.length - 1];
                    lastStep.style.opacity = '0.5';
                    lastStep.style.transform = 'scale(0.95)';
                    lastStep.style.boxShadow = 'none';
                    previousStepDiv = lastStep;
                }
                
                // Create and add the current step
                const stepDiv = document.createElement('div');
                stepDiv.className = 'equation-step';
                stepDiv.style.opacity = '0';
                stepDiv.style.transform = 'translateY(20px)';
                
                if (step.highlight) {
                    stepDiv.style.background = 'linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(0, 255, 136, 0.2))';
                }
                
                stepDiv.innerHTML = `<span style="color: #ffd700;">${step.label}</span> ${step.content}`;
                container.appendChild(stepDiv);
                
                // Animate the step appearing
                await wait(200);
                stepDiv.style.opacity = '1';
                stepDiv.style.transform = 'translateY(0)';
                stepDiv.style.transition = 'all 0.5s ease';
                stepDiv.style.boxShadow = '0 0 20px rgba(0, 255, 136, 0.5)';
                
                // Narrate if narrator is provided
                if (narrator) {
                    await narrator.speak(step.narration);
                }
                
                // Remove highlight after narration
                stepDiv.style.boxShadow = 'none';
                
                await wait(500);
            }
        }

        // Reset hall to initial state
        function resetHall() {
            const original = document.getElementById('hall-original');
            const expanded = document.getElementById('hall-expanded');
            const arrowRight = document.getElementById('arrow-right');
            const arrowBottom = document.getElementById('arrow-bottom');
            const expansionText = document.getElementById('expansion-text');
            const newAreaEq = document.getElementById('new-area-eq');
            const finalEquation = document.getElementById('final-equation');
            const expWidth = document.getElementById('exp-width');
            const expLength = document.getElementById('exp-length');
            const expArea = document.getElementById('exp-area');
            
            if (original) {
                original.style.width = '160px';
                original.style.height = '120px';
            }
            if (expanded) {
                expanded.style.width = '160px';
                expanded.style.height = '120px';
                expanded.style.opacity = '0';
            }
            if (arrowRight) arrowRight.style.opacity = '0';
            if (arrowBottom) arrowBottom.style.opacity = '0';
            if (expansionText) expansionText.style.opacity = '0';
            if (newAreaEq) newAreaEq.style.opacity = '0';
            if (finalEquation) finalEquation.style.opacity = '0';
            if (expWidth) expWidth.style.opacity = '0';
            if (expLength) expLength.style.opacity = '0';
            if (expArea) expArea.style.opacity = '0';
        }

        // Graph plotting function for parabola
        function plotParabola() {
            const canvas = document.getElementById('parabola-canvas');
            if (!canvas) return;
            
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
            
            // Generate points for the parabola y = 2x¬≤ + x - 300
            const parabolaData = [];
            for (let x = -20; x <= 20; x += 0.5) {
                const y = 2 * x * x + x - 300;
                parabolaData.push({x: x, y: y});
            }
            
            currentChart = new Chart(canvas, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'y = 2x¬≤ + x - 300',
                            data: parabolaData,
                            borderColor: '#00ff88',
                            backgroundColor: 'rgba(0, 255, 136, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0,
                            pointHoverRadius: 5,
                            showLine: true
                        },
                        {
                            label: 'X-intercepts',
                            data: [{x: 12, y: 0}, {x: -12.5, y: 0}],
                            borderColor: '#ff69b4',
                            backgroundColor: '#ff69b4',
                            borderWidth: 4,
                            pointRadius: 8,
                            pointHoverRadius: 10,
                            showLine: false,
                            type: 'scatter'
                        },
                        {
                            label: 'Vertex',
                            data: [{x: -0.25, y: -300.125}],
                            borderColor: '#ffd700',
                            backgroundColor: '#ffd700',
                            borderWidth: 4,
                            pointRadius: 8,
                            pointHoverRadius: 10,
                            showLine: false,
                            type: 'scatter'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Quadratic Function: y = 2x¬≤ + x - 300',
                            color: '#ffffff',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const x = context.parsed.x.toFixed(2);
                                    const y = context.parsed.y.toFixed(2);
                                    if (context.datasetIndex === 1) {
                                        return `Solution: x = ${x}`;
                                    } else if (context.datasetIndex === 2) {
                                        return `Vertex: (${x}, ${y})`;
                                    }
                                    return `(${x}, ${y})`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'center',
                            min: -20,
                            max: 20,
                            title: {
                                display: true,
                                text: 'x',
                                color: '#00bbff',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawBorder: true,
                                borderColor: 'rgba(255, 255, 255, 0.3)'
                            },
                            ticks: {
                                color: '#ffffff',
                                stepSize: 5
                            }
                        },
                        y: {
                            type: 'linear',
                            position: 'center',
                            min: -400,
                            max: 400,
                            title: {
                                display: true,
                                text: 'y',
                                color: '#00bbff',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawBorder: true,
                                borderColor: 'rgba(255, 255, 255, 0.3)'
                            },
                            ticks: {
                                color: '#ffffff',
                                stepSize: 100
                            }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        // Helper Functions
        function updateTitle(title) {
            document.getElementById('lesson-title').textContent = title;
        }

        function updateInfo(text) {
            const info = document.getElementById('info-display');
            info.textContent = text;
            info.classList.add('visible');
        }

        function updateAnalysis(text) {
            document.getElementById('analysis-content').textContent = text;
        }

        function setActiveButton(index) {
            document.querySelectorAll('.demo-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
        }

        function wait(ms) {
            return new Promise(resolve => {
                const timeout = setTimeout(resolve, ms);
                animationTimeouts.push(timeout);
            });
        }

        // Audio Control
        document.getElementById('mute-btn').addEventListener('click', () => {
            globalAudioEnabled = !globalAudioEnabled;
            if (currentNarrator) {
                currentNarrator.isEnabled = globalAudioEnabled;
                if (!globalAudioEnabled) {
                    currentNarrator.stop();
                }
            }
            document.getElementById('mute-btn').classList.toggle('muted', !globalAudioEnabled);
        });
    </script>
</body>
</html>