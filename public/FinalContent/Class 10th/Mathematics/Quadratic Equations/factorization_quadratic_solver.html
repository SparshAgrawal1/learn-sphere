<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quadratic Solutions by Factorization - Interactive Learning</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Audio Control */
        #audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(126, 87, 194, 0.9);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            transform: scale(1.1);
            background: rgba(126, 87, 194, 1);
        }

        .control-btn.muted .unmute-icon { display: none; }
        .control-btn:not(.muted) .mute-icon { display: none; }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3.2rem;
            background: linear-gradient(45deg, #00ff88, #00bbff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Main Animation Stage */
        .animation-stage {
            background: linear-gradient(to bottom, #1a1a2e 0%, #16213e 100%);
            border-radius: 25px;
            height: 600px;
            position: relative;
            margin: 40px 0;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            border: 4px solid rgba(0, 255, 136, 0.4);
        }

        /* Grid Background */
        .grid-background {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.3;
        }

        /* Content Container inside stage */
        .stage-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        /* Animation Scenes */
        .animation-scene {
            display: none;
            opacity: 0;
            transition: opacity 1s ease;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            padding: 40px;
        }

        .animation-scene.visible {
            display: flex;
            opacity: 1;
            align-items: center;
            justify-content: center;
        }

        /* Welcome Scene */
        .welcome-scene {
            text-align: center;
        }

        .welcome-title {
            font-size: 2.5rem;
            color: #00ff88;
            margin-bottom: 20px;
            animation: titleGlow 2s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 10px rgba(0, 255, 136, 0.5); }
            50% { text-shadow: 0 0 20px rgba(0, 255, 136, 0.8); }
        }

        /* Definition Scene */
        .definition-content {
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }

        .definition-box {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 187, 255, 0.2));
            border: 3px solid rgba(0, 255, 136, 0.5);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            transform: scale(0);
            animation: boxPop 0.8s ease forwards;
        }

        @keyframes boxPop {
            to { transform: scale(1); }
        }

        .equation-display {
            font-size: 2rem;
            color: #00ff88;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            letter-spacing: 2px;
        }

        .root-definition {
            font-size: 1.4rem;
            color: #ffd700;
            margin: 20px 0;
            font-weight: bold;
        }

        /* Factorization Animation Scene */
        .factorization-content {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }

        .factorization-container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .equation-step {
            font-size: 1.8rem;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            padding: 15px;
            border-radius: 10px;
            opacity: 0;
            transition: all 0.8s ease;
        }

        .equation-step.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .original-equation {
            background: rgba(255, 105, 180, 0.2);
            border: 2px solid #ff69b4;
            color: #ff69b4;
        }

        .factored-form {
            background: rgba(0, 255, 136, 0.2);
            border: 2px solid #00ff88;
            color: #00ff88;
        }

        .individual-factors {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #ffd700;
            color: #ffd700;
        }

        .solutions {
            background: rgba(0, 187, 255, 0.2);
            border: 2px solid #00bbff;
            color: #00bbff;
            font-size: 2rem;
        }

        /* Interactive Examples Scene */
        .examples-content {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }

        .example-selector {
            margin: 20px 0;
        }

        .example-btn {
            background: linear-gradient(135deg, #764ba2, #667eea);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .example-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.4);
        }

        .example-btn.active {
            background: linear-gradient(135deg, #00ff88, #00bbff);
        }

        /* Method Explanation Scene */
        .method-content {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .method-steps {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .method-step {
            background: linear-gradient(135deg, rgba(0, 187, 255, 0.2), rgba(255, 215, 0, 0.2));
            border: 2px solid rgba(0, 187, 255, 0.5);
            border-radius: 15px;
            padding: 15px;
            opacity: 0;
            transform: translateX(-50px);
            animation: slideInMethod 0.7s ease forwards;
        }

        .method-step:nth-child(2) { animation-delay: 0.3s; }
        .method-step:nth-child(3) { animation-delay: 0.6s; }
        .method-step:nth-child(4) { animation-delay: 0.9s; }

        @keyframes slideInMethod {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .step-number {
            font-size: 1.3rem;
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .step-description {
            font-size: 1.1rem;
            color: #ffffff;
            line-height: 1.5;
        }

        /* Prayer Hall Scene */
        .prayer-hall-content {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .hall-problem {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
        }

        .problem-statement {
            font-size: 1.3rem;
            color: #ffd700;
            margin-bottom: 20px;
        }

        .solution-steps {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .solution-step {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 10px;
            padding: 15px;
            opacity: 0;
            animation: fadeInStep 0.8s ease forwards;
        }

        .solution-step:nth-child(2) { animation-delay: 0.4s; }
        .solution-step:nth-child(3) { animation-delay: 0.8s; }
        .solution-step:nth-child(4) { animation-delay: 1.2s; }

        @keyframes fadeInStep {
            to { opacity: 1; }
        }

        /* Controls */
        .controls {
            text-align: center;
            margin: 40px 0;
        }

        .controls-title {
            font-size: 2rem;
            margin-bottom: 25px;
            color: #00ff88;
            font-weight: 600;
        }

        .demo-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .demo-btn {
            background: linear-gradient(135deg, #764ba2, #667eea);
            border: none;
            color: white;
            padding: 16px 28px;
            border-radius: 35px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(118, 75, 162, 0.3);
            min-width: 180px;
        }

        .demo-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(118, 75, 162, 0.4);
        }

        .demo-btn.active {
            background: linear-gradient(135deg, #00ff88, #00bbff);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.4);
        }

        /* Analysis Panel */
        .analysis {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 25px;
            padding: 35px;
            margin: 35px 0;
            border: 3px solid rgba(0, 255, 136, 0.4);
            backdrop-filter: blur(15px);
        }

        .analysis-title {
            font-size: 1.6rem;
            color: #00ff88;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 600;
        }

        .analysis-content {
            font-size: 1.2rem;
            line-height: 1.8;
            text-align: center;
            color: #e2e8f0;
        }

        /* Info Display */
        .info-display {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 15px 20px;
            text-align: center;
            font-size: 1.1rem;
            opacity: 0;
            transition: opacity 0.5s ease;
            backdrop-filter: blur(10px);
            z-index: 100;
        }

        .info-display.visible {
            opacity: 1;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.2rem;
            }
            
            .animation-stage {
                height: 500px;
            }
            
            .demo-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .equation-display {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Control -->
    <div id="audio-control">
        <button id="mute-btn" class="control-btn">
            <span class="unmute-icon">üîä</span>
            <span class="mute-icon">üîá</span>
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Solution by Factorization</h1>
            <p>Master the art of solving quadratic equations through factorization with interactive animations!</p>
        </div>

        <!-- Main Animation Stage -->
        <div class="animation-stage" id="animation-stage">
            <div class="grid-background"></div>
            
            <!-- Stage Content Container -->
            <div class="stage-content">
                <!-- Welcome Scene -->
                <div class="animation-scene visible" id="welcome-scene">
                    <div class="welcome-scene">
                        <h2 class="welcome-title">Welcome to Factorization!</h2>
                        <p style="font-size: 1.3rem; color: #00bbff;">
                            Learn to solve quadratic equations by breaking them<br>
                            into factors and finding their roots
                        </p>
                    </div>
                </div>

                <!-- Definition Scene -->
                <div class="animation-scene" id="definition-scene">
                    <div class="definition-content">
                        <h2 style="font-size: 2rem; color: #00ff88; margin-bottom: 20px;">
                            Understanding Roots
                        </h2>
                        <div class="definition-box">
                            <div class="root-definition">
                                Root (Œ±): A value that makes the equation equal to zero
                            </div>
                            <div class="equation-display">
                                aŒ±¬≤ + bŒ± + c = 0
                            </div>
                            <p style="font-size: 1.2rem; margin-top: 20px; color: #00bbff;">
                                A quadratic equation can have a maximum of <strong style="color: #ffd700;">2 roots</strong>
                            </p>
                            <p style="font-size: 1.1rem; margin-top: 15px; color: #ffffff;">
                                Factorization helps us find these roots by splitting the equation into factors
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Method Explanation Scene -->
                <div class="animation-scene" id="method-scene">
                    <div class="method-content">
                        <h2 style="font-size: 2rem; color: #00ff88; margin-bottom: 20px;">
                            Factorization Method
                        </h2>
                        <div class="method-steps">
                            <div class="method-step">
                                <div class="step-number">Step 1</div>
                                <div class="step-description">
                                    <strong>Write in standard form:</strong> ax¬≤ + bx + c = 0
                                </div>
                            </div>
                            <div class="method-step">
                                <div class="step-number">Step 2</div>
                                <div class="step-description">
                                    <strong>Split the middle term:</strong> Find two numbers that multiply to ac and add to b
                                </div>
                            </div>
                            <div class="method-step">
                                <div class="step-number">Step 3</div>
                                <div class="step-description">
                                    <strong>Factor by grouping:</strong> Group terms and factor out common factors
                                </div>
                            </div>
                            <div class="method-step">
                                <div class="step-number">Step 4</div>
                                <div class="step-description">
                                    <strong>Apply zero product property:</strong> If (p)(q) = 0, then p = 0 or q = 0
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Animated Factorization Scene -->
                <div class="animation-scene" id="factorization-scene">
                    <div class="factorization-content">
                        <h2 style="font-size: 2rem; color: #00ff88; margin-bottom: 20px;">
                            Step-by-Step Factorization
                        </h2>
                        <div class="factorization-container">
                            <!-- Single step display that changes content -->
                            <div id="current-factorization-step" style="padding: 30px; background: rgba(255, 105, 180, 0.2); border: 3px solid #ff69b4; border-radius: 15px; min-height: 200px; display: flex; flex-direction: column; justify-content: center; transition: all 0.8s ease;">
                                <div id="step-explanation" style="font-size: 1.3rem; color: #ffd700; margin-bottom: 20px; text-align: center;">
                                    Ready to solve: 2x¬≤ - 5x + 3 = 0
                                </div>
                                <div id="step-equation" style="font-size: 2rem; color: #ff69b4; font-family: 'Courier New', monospace; text-align: center; margin: 20px 0;">
                                    2x¬≤ - 5x + 3 = 0
                                </div>
                                <div id="step-details" style="font-size: 1.1rem; color: #ffffff; text-align: center; line-height: 1.6;">
                                    Click "Start Animation" to begin the factorization process
                                </div>
                            </div>
                            
                            <!-- Navigation controls -->
                            <div style="margin-top: 25px; text-align: center;">
                                <button id="prev-factorization-btn" onclick="showPreviousFactorizationStep()" style="background: rgba(118, 75, 162, 0.8); border: none; color: white; padding: 12px 24px; border-radius: 25px; margin: 0 10px; cursor: pointer; opacity: 0.5;" disabled>‚Üê Previous</button>
                                <button id="start-factorization-btn" onclick="startFactorizationAnimation()" style="background: linear-gradient(135deg, #00ff88, #00bbff); border: none; color: white; padding: 12px 24px; border-radius: 25px; margin: 0 10px; cursor: pointer;">Start Animation</button>
                                <button id="next-factorization-btn" onclick="showNextFactorizationStep()" style="background: linear-gradient(135deg, #00ff88, #00bbff); border: none; color: white; padding: 12px 24px; border-radius: 25px; margin: 0 10px; cursor: pointer; opacity: 0.5;" disabled>Next ‚Üí</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Interactive Examples Scene -->
                <div class="animation-scene" id="examples-scene">
                    <div class="examples-content">
                        <h2 style="font-size: 2rem; color: #00ff88; margin-bottom: 20px;">
                            Interactive Examples
                        </h2>
                        <div class="example-selector">
                            <button class="example-btn active" onclick="selectExample(0)">Example 1: 2x¬≤ - 5x + 3</button>
                            <button class="example-btn" onclick="selectExample(1)">Example 2: 6x¬≤ - x - 2</button>
                            <button class="example-btn" onclick="selectExample(2)">Example 3: x¬≤ - 7x + 12</button>
                        </div>
                        <div class="factorization-container">
                            <div id="example-display">
                                <div class="equation-step original-equation">
                                    2x¬≤ - 5x + 3 = 0
                                </div>
                                <div class="equation-step" style="color: #ffffff; background: rgba(255, 255, 255, 0.1);">
                                    Method: Split -5x into -3x - 2x
                                </div>
                                <div class="equation-step factored-form">
                                    (2x - 3)(x - 1) = 0
                                </div>
                                <div class="equation-step solutions">
                                    Roots: x = 3/2, x = 1
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Prayer Hall Problem Scene -->
                <div class="animation-scene" id="prayer-hall-scene">
                    <div class="prayer-hall-content">
                        <h2 style="font-size: 2rem; color: #00ff88; margin-bottom: 20px;">
                            Real-Life Application: Prayer Hall
                        </h2>
                        <div class="hall-problem">
                            <div class="problem-statement">
                                A prayer hall expansion creates the equation: 2x¬≤ + 55x = 0<br>
                                Let's solve it using factorization!
                            </div>
                            <div class="solution-steps">
                                <div class="solution-step">
                                    <strong>Original equation:</strong> 2x¬≤ + 55x = 0
                                </div>
                                <div class="solution-step">
                                    <strong>Factor out x:</strong> x(2x + 55) = 0
                                </div>
                                <div class="solution-step">
                                    <strong>Apply zero product property:</strong> x = 0 or 2x + 55 = 0
                                </div>
                                <div class="solution-step">
                                    <strong>Solutions:</strong> x = 0 or x = -27.5<br>
                                    <em style="color: #ff69b4;">In context: Only x = 0 makes physical sense</em>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Info Display -->
            <div class="info-display visible" id="info-display">
                Choose a topic below to start learning about factorization!
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-title" id="lesson-title">Choose Your Learning Path</div>
            
            <div class="demo-buttons">
                <button class="demo-btn" onclick="showDefinition()">üìñ Roots & Definition</button>
                <button class="demo-btn" onclick="showMethod()">üîß Factorization Method</button>
                <button class="demo-btn" onclick="showFactorization()">üé¨ Animated Example</button>
                <button class="demo-btn" onclick="showExamples()">üî¢ Interactive Examples</button>
                <button class="demo-btn" onclick="showPrayerHall()">üèõÔ∏è Real-Life Problem</button>
                <button class="demo-btn" onclick="resetAll()">üîÑ Reset</button>
            </div>
        </div>

        <!-- Analysis Panel -->
        <div class="analysis">
            <div class="analysis-title">üìä Understanding Factorization</div>
            <div class="analysis-content" id="analysis-content">
                Factorization is a powerful method for solving quadratic equations by expressing them as products of linear factors. 
                This approach reveals the roots directly and provides insight into the equation's structure and behavior.
            </div>
        </div>
    </div>

    <script>
        // Voice System
        class FactorizationNarrator {
            constructor() {
                this.isEnabled = globalAudioEnabled;
                this.currentUtterance = null;
                this.settings = { rate: 0.95, pitch: 1.0, volume: 0.85 };
                this.isDestroyed = false;
            }

            async speak(text, delay = 0) {
                if (!this.isEnabled || !text || this.isDestroyed) return;
                
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (this.isDestroyed) {
                            resolve();
                            return;
                        }
                        this.stop();
                        const utterance = new SpeechSynthesisUtterance(text);
                        Object.assign(utterance, this.settings);
                        
                        utterance.onend = resolve;
                        utterance.onerror = resolve;
                        
                        this.currentUtterance = utterance;
                        speechSynthesis.speak(utterance);
                    }, delay);
                });
            }

            stop() {
                speechSynthesis.cancel();
                this.currentUtterance = null;
            }

            destroy() {
                this.isDestroyed = true;
                this.stop();
                this.currentUtterance = null;
                this.settings = null;
            }
        }

        // Global state management
        let globalAudioEnabled = true;
        let currentNarrator = null;
        let isPlaying = false;
        let currentDemoAborted = false;
        let currentTaskId = null;
        let animationTimeouts = [];
        let currentExampleIndex = 0;

        // Examples data
        const examples = [
            {
                equation: "2x¬≤ - 5x + 3 = 0",
                factored: "(2x - 3)(x - 1) = 0",
                roots: "x = 3/2, x = 1",
                description: "Split -5x into -3x - 2x"
            },
            {
                equation: "6x¬≤ - x - 2 = 0",
                factored: "(3x - 2)(2x + 1) = 0",
                roots: "x = 2/3, x = -1/2",
                description: "Split -x into -4x + 3x"
            },
            {
                equation: "x¬≤ - 7x + 12 = 0",
                factored: "(x - 3)(x - 4) = 0",
                roots: "x = 3, x = 4",
                description: "Split -7x into -3x - 4x"
            }
        ];

        // Function to stop current demo
        function stopCurrentDemo() {
            currentDemoAborted = true;
            currentTaskId = null;
            
            if (currentNarrator) {
                currentNarrator.destroy();
                currentNarrator = null;
            }
            
            animationTimeouts.forEach(timeout => clearTimeout(timeout));
            animationTimeouts = [];
            
            document.querySelectorAll('.animation-scene').forEach(scene => {
                scene.classList.remove('visible');
            });
            
            updateInfo("Choose a topic below to continue learning!");
            isPlaying = false;
        }

        function shouldContinue(taskId = null) {
            if (taskId && currentTaskId && taskId !== currentTaskId) {
                return false;
            }
            return !currentDemoAborted;
        }

        function createNewNarrator(taskId = null) {
            if (currentNarrator) {
                currentNarrator.destroy();
                currentNarrator = null;
            }
            currentDemoAborted = false;
            currentTaskId = taskId;
            currentNarrator = new FactorizationNarrator();
            return currentNarrator;
        }

        function switchToScene(sceneId, taskId = null) {
            if (!shouldContinue(taskId)) return;
            
            document.querySelectorAll('.animation-scene').forEach(scene => {
                scene.classList.remove('visible');
            });
            
            const timeout = setTimeout(() => {
                if (!shouldContinue(taskId)) return;
                const scene = document.getElementById(sceneId);
                if (scene) {
                    scene.classList.add('visible');
                }
            }, 300);
            
            animationTimeouts.push(timeout);
        }

        // Initialize
        window.addEventListener('load', () => {
            document.getElementById('welcome-scene').classList.add('visible');
            const narrator = createNewNarrator('initialization');
            narrator.speak("Welcome to Factorization! Learn how to solve quadratic equations by breaking them into factors and finding their roots.");
            updateInfo("Choose a topic below to start learning about factorization!");
        });

        // Show Definition
        async function showDefinition() {
            const taskId = 'definition';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(0);
            
            const narrator = createNewNarrator(taskId);
            
            await resetAll();
            if (!shouldContinue(taskId)) return;
            
            updateTitle("üìñ Roots & Definition");
            switchToScene('definition-scene', taskId);
            updateInfo("Understanding what roots are and why factorization works");
            
            await narrator.speak("A root of a quadratic equation is a value alpha that makes the equation equal to zero when substituted for x.");
            await wait(3500);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("A quadratic equation can have at most 2 roots. Factorization helps us find these roots systematically.");
            
            updateAnalysis("Roots are the x-values where the parabola crosses the x-axis. Finding roots by factorization involves expressing the quadratic as a product of linear factors, then using the zero product property.");
            
            isPlaying = false;
        }

        // Show Method
        async function showMethod() {
            const taskId = 'method';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(1);
            
            const narrator = createNewNarrator(taskId);
            
            await resetAll();
            if (!shouldContinue(taskId)) return;
            
            updateTitle("üîß Factorization Method");
            switchToScene('method-scene', taskId);
            updateInfo("Learning the systematic approach to factorization");
            
            await narrator.speak("The factorization method follows four systematic steps to solve quadratic equations.");
            await wait(3000);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("First, ensure the equation is in standard form. Then split the middle term, factor by grouping, and apply the zero product property.");
            
            updateAnalysis("This method works by splitting the middle term into two terms whose coefficients multiply to give 'ac' and add to give 'b'. This allows us to factor by grouping and find the roots.");
            
            isPlaying = false;
        }

        // Show Factorization Animation
        async function showFactorization() {
            const taskId = 'factorization';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(2);
            
            const narrator = createNewNarrator(taskId);
            
            await resetAll();
            if (!shouldContinue(taskId)) return;
            
            updateTitle("üé¨ Step-by-Step Factorization");
            switchToScene('factorization-scene', taskId);
            updateInfo("Navigate through each step to understand factorization");
            
            // Reset to first step
            currentFactorizationStep = 0;
            showFactorizationStep(0);
            
            await narrator.speak("Welcome to step-by-step factorization! Use the controls to move through each step at your own pace, or click Start Animation to begin.");
            
            updateAnalysis("This interactive demonstration breaks down factorization into clear, manageable steps. Each step includes detailed explanations to help you understand the reasoning behind every mathematical operation.");
            
            isPlaying = false;
        }

        // Factorization step-by-step variables
        let currentFactorizationStep = 0;
        let isFactorizationAnimating = false;
        
        const factorizationSteps = [
            {
                explanation: "Original Equation",
                equation: "2x¬≤ - 5x + 3 = 0",
                details: "We start with a quadratic equation in standard form ax¬≤ + bx + c = 0, where a = 2, b = -5, and c = 3",
                backgroundColor: "rgba(255, 105, 180, 0.2)",
                borderColor: "#ff69b4",
                textColor: "#ff69b4"
            },
            {
                explanation: "Find factors of ac that add to b",
                equation: "ac = 2 √ó 3 = 6, b = -5",
                details: "We need two numbers that multiply to 6 and add to -5. These numbers are -3 and -2 because (-3) √ó (-2) = 6 and (-3) + (-2) = -5",
                backgroundColor: "rgba(255, 215, 0, 0.2)",
                borderColor: "#ffd700",
                textColor: "#ffd700"
            },
            {
                explanation: "Split the middle term",
                equation: "-5x = -3x - 2x",
                details: "We replace -5x with -3x - 2x. This allows us to group the terms for factoring in the next step",
                backgroundColor: "rgba(0, 187, 255, 0.2)",
                borderColor: "#00bbff",
                textColor: "#00bbff"
            },
            {
                explanation: "Rewrite with split terms",
                equation: "2x¬≤ - 3x - 2x + 3 = 0",
                details: "Now we have four terms that we can group in pairs for factoring. Notice the order: first two terms and last two terms",
                backgroundColor: "rgba(255, 255, 255, 0.1)",
                borderColor: "#ffffff",
                textColor: "#ffffff"
            },
            {
                explanation: "Factor by grouping",
                equation: "x(2x - 3) - 1(2x - 3) = 0",
                details: "From the first pair (2x¬≤ - 3x), we factor out x. From the second pair (-2x + 3), we factor out -1. Both groups now contain (2x - 3)",
                backgroundColor: "rgba(0, 255, 200, 0.2)",
                borderColor: "#00ffc8",
                textColor: "#00ffc8"
            },
            {
                explanation: "Factor out common binomial",
                equation: "(2x - 3)(x - 1) = 0",
                details: "Since both terms contain (2x - 3), we can factor it out, leaving us with (2x - 3)(x - 1) = 0",
                backgroundColor: "rgba(0, 255, 136, 0.2)",
                borderColor: "#00ff88",
                textColor: "#00ff88"
            },
            {
                explanation: "Apply zero product property",
                equation: "2x - 3 = 0  or  x - 1 = 0",
                details: "If the product of two factors equals zero, then at least one factor must equal zero. So either 2x - 3 = 0 or x - 1 = 0",
                backgroundColor: "rgba(255, 215, 0, 0.3)",
                borderColor: "#ffd700",
                textColor: "#ffd700"
            },
            {
                explanation: "Solve for x",
                equation: "x = 3/2  or  x = 1",
                details: "From 2x - 3 = 0, we get 2x = 3, so x = 3/2. From x - 1 = 0, we get x = 1. These are our two roots!",
                backgroundColor: "rgba(0, 187, 255, 0.3)",
                borderColor: "#00bbff",
                textColor: "#00bbff"
            }
        ];

        function showFactorizationStep(index) {
            if (index < 0 || index >= factorizationSteps.length) return;
            
            const step = factorizationSteps[index];
            const container = document.getElementById('current-factorization-step');
            const explanation = document.getElementById('step-explanation');
            const equation = document.getElementById('step-equation');
            const details = document.getElementById('step-details');
            const prevBtn = document.getElementById('prev-factorization-btn');
            const nextBtn = document.getElementById('next-factorization-btn');
            const startBtn = document.getElementById('start-factorization-btn');
            
            // Animate transition
            container.style.opacity = '0';
            setTimeout(() => {
                explanation.textContent = step.explanation;
                equation.textContent = step.equation;
                details.textContent = step.details;
                
                container.style.background = step.backgroundColor;
                container.style.borderColor = step.borderColor;
                equation.style.color = step.textColor;
                
                container.style.opacity = '1';
            }, 200);
            
            // Update button states
            prevBtn.disabled = index === 0;
            prevBtn.style.opacity = index === 0 ? '0.5' : '1';
            
            nextBtn.disabled = index === factorizationSteps.length - 1;
            nextBtn.style.opacity = index === factorizationSteps.length - 1 ? '0.5' : '1';
            
            if (index === factorizationSteps.length - 1) {
                nextBtn.textContent = 'Complete!';
                nextBtn.style.background = 'rgba(0, 255, 136, 0.8)';
            } else {
                nextBtn.textContent = 'Next ‚Üí';
                nextBtn.style.background = 'linear-gradient(135deg, #00ff88, #00bbff)';
            }
            
            // Hide start button after first step
            if (index > 0) {
                startBtn.style.display = 'none';
                nextBtn.disabled = false;
                nextBtn.style.opacity = '1';
            } else {
                startBtn.style.display = 'inline-block';
                nextBtn.disabled = true;
                nextBtn.style.opacity = '0.5';
            }
            
            currentFactorizationStep = index;
        }

        async function startFactorizationAnimation() {
            isFactorizationAnimating = true;
            
            const narrator = currentNarrator;
            if (narrator) {
                await narrator.speak("Let's solve 2x squared minus 5x plus 3 equals zero step by step using factorization.");
            }
            
            showFactorizationStep(1);
        }

        function showNextFactorizationStep() {
            if (currentFactorizationStep < factorizationSteps.length - 1) {
                showFactorizationStep(currentFactorizationStep + 1);
                
                // Add narration for each step
                const step = factorizationSteps[currentFactorizationStep];
                if (currentNarrator) {
                    currentNarrator.speak(step.details);
                }
            }
        }

        function showPreviousFactorizationStep() {
            if (currentFactorizationStep > 0) {
                showFactorizationStep(currentFactorizationStep - 1);
            }
        }

        // Show Interactive Examples
        async function showExamples() {
            const taskId = 'examples';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(3);
            
            const narrator = createNewNarrator(taskId);
            
            await resetAll();
            if (!shouldContinue(taskId)) return;
            
            updateTitle("üî¢ Interactive Examples");
            switchToScene('examples-scene', taskId);
            updateInfo("Explore different quadratic equations and their solutions");
            
            await narrator.speak("Here are three different examples of quadratic equations solved by factorization. Click the buttons to explore each one.");
            
            updateAnalysis("Each example demonstrates different factorization patterns. Notice how the middle term splitting strategy varies based on the coefficients in each equation.");
            
            isPlaying = false;
        }

        // Show Prayer Hall Problem
        async function showPrayerHall() {
            const taskId = 'prayer-hall';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(4);
            
            const narrator = createNewNarrator(taskId);
            
            await resetAll();
            if (!shouldContinue(taskId)) return;
            
            updateTitle("üèõÔ∏è Real-Life Application");
            switchToScene('prayer-hall-scene', taskId);
            updateInfo("Solving the prayer hall expansion problem using factorization");
            
            await narrator.speak("Let's solve our prayer hall problem using factorization. The equation 2x squared plus 55x equals zero can be factored easily.");
            await wait(4000);
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("By factoring out x, we get x times 2x plus 55 equals zero, giving us roots x equals 0 and x equals negative 27.5.");
            
            updateAnalysis("In real-world contexts, we must interpret mathematical solutions practically. Here, only x = 0 makes physical sense, indicating no expansion maintains the original area constraint.");
            
            isPlaying = false;
        }

        // Example selection
        function selectExample(index) {
            currentExampleIndex = index;
            const example = examples[index];
            
            console.log('Selecting example:', index, example);
            
            // Update button states
            document.querySelectorAll('.example-selector .example-btn').forEach((btn, i) => {
                btn.classList.remove('active');
                if (i === index) {
                    btn.classList.add('active');
                }
            });
            
            // Update display
            const display = document.getElementById('example-display');
            console.log('Display element:', display);
            
            if (display) {
                // Make sure the container is visible and has proper styling
                const container = display.parentElement;
                if (container) {
                    container.style.display = 'block';
                    container.style.visibility = 'visible';
                    container.style.opacity = '1';
                    container.style.paddingBottom = '60px'; // Add space for the bottom info strip
                }
                
                // Force display properties and add important styles
                display.style.display = 'block !important';
                display.style.visibility = 'visible !important';
                display.style.opacity = '1 !important';
                display.style.position = 'relative';
                display.style.zIndex = '10';
                display.style.width = '100%';
                display.style.minHeight = '300px';
                
                // Clear and set content with premium colors and reduced padding
                display.innerHTML = `
                    <div style="background: linear-gradient(135deg, #e91e63, #ad1457) !important; border: 2px solid #f8bbd9 !important; color: #ffffff !important; padding: 12px !important; margin: 8px 0 !important; border-radius: 12px !important; font-size: 1.6rem !important; font-family: 'Courier New', monospace !important; text-align: center !important; display: block !important; visibility: visible !important; opacity: 1 !important; box-shadow: 0 4px 15px rgba(233, 30, 99, 0.3) !important;">
                        ${example.equation}
                    </div>
                    <div style="background: linear-gradient(135deg, #37474f, #263238) !important; border: 2px solid #78909c !important; color: #ffffff !important; font-size: 1.1rem !important; padding: 12px !important; margin: 8px 0 !important; border-radius: 12px !important; text-align: center !important; display: block !important; visibility: visible !important; opacity: 1 !important; box-shadow: 0 4px 15px rgba(55, 71, 79, 0.3) !important;">
                        <strong style="color: #81c784 !important;">Method:</strong> ${example.description}
                    </div>
                    <div style="background: linear-gradient(135deg, #00c853, #1b5e20) !important; border: 2px solid #a5d6a7 !important; color: #ffffff !important; padding: 12px !important; margin: 8px 0 !important; border-radius: 12px !important; font-size: 1.6rem !important; font-family: 'Courier New', monospace !important; text-align: center !important; display: block !important; visibility: visible !important; opacity: 1 !important; box-shadow: 0 4px 15px rgba(0, 200, 83, 0.3) !important;">
                        ${example.factored}
                    </div>
                    <div style="background: linear-gradient(135deg, #2196f3, #0d47a1) !important; border: 2px solid #90caf9 !important; color: #ffffff !important; padding: 12px !important; margin: 8px 0 !important; border-radius: 12px !important; font-size: 1.6rem !important; font-family: 'Courier New', monospace !important; text-align: center !important; display: block !important; visibility: visible !important; opacity: 1 !important; box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3) !important;">
                        <strong style="color: #e3f2fd !important;">Roots:</strong> ${example.roots}
                    </div>
                `;
                
                console.log('Updated display content');
            } else {
                console.error('example-display element not found');
            }
            
            // Add voice narration
            if (currentNarrator) {
                const equationText = example.equation.replace(/x¬≤/g, 'x squared').replace(/\*/g, 'times');
                setTimeout(() => {
                    currentNarrator.speak(`Example ${index + 1}: ${equationText}. Method: ${example.description}.`);
                }, 500);
            }
        }

        function nextExample() {
            currentExampleIndex = (currentExampleIndex + 1) % examples.length;
            selectExample(currentExampleIndex);
        }

        // Reset
        async function resetAll() {
            if (currentNarrator) currentNarrator.stop();
            
            animationTimeouts.forEach(timeout => clearTimeout(timeout));
            animationTimeouts = [];
            
            document.querySelectorAll('.animation-scene').forEach(scene => {
                scene.classList.remove('visible');
            });
            
            await wait(50);
            document.getElementById('welcome-scene').classList.add('visible');
            
            updateTitle("Choose Your Learning Path");
            updateInfo("Choose a topic below to start learning about factorization!");
            updateAnalysis("Factorization is a powerful method for solving quadratic equations by expressing them as products of linear factors. This approach reveals the roots directly and provides insight into the equation's structure and behavior.");
            
            setActiveButton(-1);
            
            await wait(50);
        }

        // Helper Functions
        function updateTitle(title) {
            document.getElementById('lesson-title').textContent = title;
        }

        function updateInfo(text) {
            const info = document.getElementById('info-display');
            info.textContent = text;
            info.classList.add('visible');
        }

        function updateAnalysis(text) {
            document.getElementById('analysis-content').textContent = text;
        }

        function setActiveButton(index) {
            document.querySelectorAll('.demo-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
        }

        function wait(ms) {
            return new Promise(resolve => {
                const timeout = setTimeout(resolve, ms);
                animationTimeouts.push(timeout);
            });
        }

        // Audio Control
        document.getElementById('mute-btn').addEventListener('click', () => {
            globalAudioEnabled = !globalAudioEnabled;
            if (currentNarrator) {
                currentNarrator.isEnabled = globalAudioEnabled;
                if (!globalAudioEnabled) {
                    currentNarrator.stop();
                }
            }
            document.getElementById('mute-btn').classList.toggle('muted', !globalAudioEnabled);
        });
    </script>
</body>
</html>