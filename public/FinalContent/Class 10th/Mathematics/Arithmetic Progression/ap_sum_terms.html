<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sum of First n Terms - AP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 25%, #16213e 50%, #0f3460 100%);
            background-attachment: fixed;
            color: #ffffff;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(79, 172, 254, 0.08) 0%, transparent 60%),
                radial-gradient(circle at 80% 70%, rgba(16, 185, 129, 0.06) 0%, transparent 60%);
            pointer-events: none;
            z-index: -1;
        }

        /* Audio Control */
        #audio-control {
            position: fixed;
            top: 25px;
            right: 25px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 15px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(79, 172, 254, 0.2);
        }

        .control-btn.muted .unmute-icon { display: none; }
        .control-btn:not(.muted) .mute-icon { display: none; }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #a855f7 0%, #3b82f6 30%, #06b6d4 60%, #10b981 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .header p {
            font-size: 1.2rem;
            color: #cbd5e1;
            margin: 0 auto;
        }

        /* Main Animation Stage */
        .animation-stage {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            height: 550px;
            position: relative;
            margin: 30px 0;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Content Scenes */
        .content-scene {
            display: none;
            opacity: 0;
            padding: 20px;
            text-align: center;
            width: 100%;
            height: 100%;
            transition: opacity 0.8s ease;
            position: absolute;
            top: 0;
            left: 0;
        }

        .content-scene.visible {
            display: flex;
            opacity: 1;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .scene-title {
            font-size: 2.2rem;
            color: #3b82f6;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .scene-content {
            max-width: 900px;
            width: 100%;
        }

        /* Step containers */
        .step-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin: 15px 0;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
        }

        .step-container.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .step-title {
            font-size: 1.4rem;
            color: #10b981;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .step-description {
            color: #e2e8f0;
            line-height: 1.6;
            font-size: 1.1rem;
            margin-bottom: 12px;
        }

        /* Gauss visualization */
        .gauss-demonstration {
            background: rgba(168, 85, 247, 0.1);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }

        .number-sequence {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .number-box {
            background: rgba(59, 130, 246, 0.3);
            border: 1px solid rgba(59, 130, 246, 0.5);
            border-radius: 8px;
            padding: 8px 12px;
            color: #60a5fa;
            font-weight: 600;
            min-width: 40px;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.3s ease;
        }

        .number-box.visible {
            opacity: 1;
            transform: scale(1);
        }

        .number-box.paired {
            background: rgba(16, 185, 129, 0.3);
            border-color: rgba(16, 185, 129, 0.5);
            color: #34d399;
        }

        /* Formula displays */
        .formula-display {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(79, 172, 254, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin: 12px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.4rem;
            color: #06b6d4;
            text-align: center;
        }

        .formula-derivation {
            background: rgba(168, 85, 247, 0.1);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin: 12px 0;
            font-family: 'Courier New', monospace;
            color: #a855f7;
        }

        .derivation-step {
            margin: 10px 0;
            font-size: 1.1rem;
            opacity: 0;
            transform: translateX(-20px);
            transition: all 0.5s ease;
        }

        .derivation-step.visible {
            opacity: 1;
            transform: translateX(0);
        }

        /* Example containers */
        .example-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .example-box {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            padding: 20px;
            color: #10b981;
            opacity: 0;
            transform: scale(0.9);
            transition: all 0.5s ease;
        }

        .example-box.visible {
            opacity: 1;
            transform: scale(1);
        }

        .example-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #fbbf24;
        }

        .example-problem {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: #e2e8f0;
        }

        .example-solution {
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            line-height: 1.5;
            color: #10b981;
        }

        /* Interactive calculator */
        .calculator-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            margin: 15px 0;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-label {
            color: #94a3b8;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .input-field {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px 12px;
            color: white;
            font-size: 1rem;
        }

        .calculate-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            margin: 15px auto;
            display: block;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }

        .result-display {
            margin-top: 15px;
            padding: 15px;
            border-radius: 12px;
            font-weight: 600;
            display: none;
            text-align: center;
        }

        .result-display.success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.4);
            color: #10b981;
        }

        .result-display.error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            color: #ef4444;
        }

        /* Application examples */
        .application-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .application-card {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 20px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .application-card.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .app-title {
            font-size: 1.3rem;
            color: #60a5fa;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .app-description {
            color: #e2e8f0;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .app-calculation {
            font-family: 'Courier New', monospace;
            color: #34d399;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        /* Controls */
        .controls {
            text-align: center;
            margin: 30px 0;
        }

        .controls-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #ffffff;
            font-weight: 600;
        }

        .demo-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .demo-btn {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #ffffff;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 160px;
        }

        .demo-btn:hover {
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
            transform: translateY(-2px);
        }

        .demo-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        /* Analysis Panel */
        .analysis {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            margin: 25px 0;
        }

        .analysis-title {
            font-size: 1.4rem;
            color: #3b82f6;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }

        .analysis-content {
            font-size: 1rem;
            line-height: 1.6;
            color: #e2e8f0;
            text-align: center;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.2rem;
            }
            
            .animation-stage {
                height: 500px;
            }
            
            .content-scene {
                padding: 15px;
            }
            
            .demo-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .example-container,
            .input-grid,
            .application-grid {
                grid-template-columns: 1fr;
            }
            
            .number-sequence {
                gap: 4px;
            }
            
            .number-box {
                padding: 6px 8px;
                min-width: 35px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Control -->
    <div id="audio-control">
        <button id="mute-btn" class="control-btn">
            <span class="unmute-icon">üîä</span>
            <span class="mute-icon">üîá</span>
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Sum of First n Terms</h1>
            <p>Master Gauss's method and advanced sum formulas for arithmetic progressions</p>
        </div>

        <!-- Main Animation Stage -->
        <div class="animation-stage">
            
            <!-- Welcome Scene -->
            <div class="content-scene visible" id="welcome-scene">
                <div class="scene-title">Sum Formula Mastery</div>
                <div class="scene-content">
                    <p style="font-size: 1.3rem; color: #cbd5e1; line-height: 1.6;">
                        Discover the elegant methods to find the sum of arithmetic progressions,
                        from Gauss's brilliant insight to modern applications.
                    </p>
                    <div class="formula-display" style="margin-top: 30px;">
                        S‚Çô = n/2[2a + (n-1)d]
                    </div>
                    <div class="formula-display">
                        S‚Çô = n/2(a + l)
                    </div>
                </div>
            </div>

            <!-- Historical Context Scene -->
            <div class="content-scene" id="historical-scene">
                <div class="scene-title">Gauss's Method</div>
                <div class="scene-content">
                    <div class="step-container">
                        <div class="step-title">The Young Genius</div>
                        <div class="step-description">
                            When Gauss was 10, his teacher asked the class to find 1 + 2 + 3 + ... + 100.
                            While others began adding slowly, Gauss found the answer in seconds: 5050.
                        </div>
                    </div>
                    
                    <div class="gauss-demonstration" id="gauss-demo">
                        <div style="margin-bottom: 15px; color: #a855f7; font-weight: 600;">Forward: S = 1 + 2 + 3 + ... + 98 + 99 + 100</div>
                        <div class="number-sequence" id="forward-sequence">
                            <div class="number-box">1</div>
                            <div class="number-box">2</div>
                            <div class="number-box">3</div>
                            <div class="number-box">...</div>
                            <div class="number-box">98</div>
                            <div class="number-box">99</div>
                            <div class="number-box">100</div>
                        </div>
                        
                        <div style="margin: 15px 0; color: #a855f7; font-weight: 600;">Reverse: S = 100 + 99 + 98 + ... + 3 + 2 + 1</div>
                        <div class="number-sequence" id="reverse-sequence">
                            <div class="number-box">100</div>
                            <div class="number-box">99</div>
                            <div class="number-box">98</div>
                            <div class="number-box">...</div>
                            <div class="number-box">3</div>
                            <div class="number-box">2</div>
                            <div class="number-box">1</div>
                        </div>
                        
                        <div style="margin-top: 15px; color: #10b981; font-weight: 600;">2S = 101 + 101 + 101 + ... + 101 (100 times)</div>
                        <div style="margin-top: 10px; color: #fbbf24; font-size: 1.2rem;">S = 100 √ó 101 / 2 = 5050</div>
                    </div>
                </div>
            </div>

            <!-- Formula Derivation Scene -->
            <div class="content-scene" id="derivation-scene">
                <div class="scene-title">Formula Derivation</div>
                <div class="scene-content">
                    <div class="step-container">
                        <div class="step-title">General Method</div>
                        <div class="step-description">
                            Applying Gauss's technique to any arithmetic progression:
                        </div>
                        
                        <div class="formula-derivation" id="derivation-steps">
                            <div class="derivation-step">S = a + (a+d) + (a+2d) + ... + [a+(n-1)d]</div>
                            <div class="derivation-step">S = [a+(n-1)d] + [a+(n-2)d] + ... + (a+d) + a</div>
                            <div class="derivation-step">2S = [2a+(n-1)d] + [2a+(n-1)d] + ... + [2a+(n-1)d]</div>
                            <div class="derivation-step">2S = n √ó [2a + (n-1)d]</div>
                            <div class="derivation-step">S = n/2 √ó [2a + (n-1)d]</div>
                        </div>
                        
                        <div class="step-description" style="margin-top: 15px;">
                            Alternative form using first and last terms:
                        </div>
                        <div class="formula-display">
                            S‚Çô = n/2(a + l)
                        </div>
                    </div>
                </div>
            </div>

            <!-- Examples Scene -->
            <div class="content-scene" id="examples-scene">
                <div class="scene-title">Worked Examples</div>
                <div class="scene-content">
                    <div class="example-container" id="examples-grid">
                        <div class="example-box">
                            <div class="example-title">Example 1: Direct Sum</div>
                            <div class="example-problem">Sum of first 22 terms: 8, 3, -2, ...</div>
                            <div class="example-solution">
                                a = 8, d = -5, n = 22<br>
                                S‚ÇÇ‚ÇÇ = 22/2[2√ó8 + (22-1)√ó(-5)]<br>
                                = 11[16 + 21√ó(-5)]<br>
                                = 11[16 - 105] = -979
                            </div>
                        </div>
                        
                        <div class="example-box">
                            <div class="example-title">Example 2: Find Term from Sum</div>
                            <div class="example-problem">S‚ÇÅ‚ÇÑ = 1050, a = 10, find 20th term</div>
                            <div class="example-solution">
                                1050 = 14/2[20 + 13d]<br>
                                1050 = 7[20 + 13d]<br>
                                150 = 20 + 13d<br>
                                d = 10, so a‚ÇÇ‚ÇÄ = 10 + 19√ó10 = 200
                            </div>
                        </div>
                        
                        <div class="example-box">
                            <div class="example-title">Example 3: Find n from Sum</div>
                            <div class="example-problem">How many terms of 24, 21, 18... sum to 78?</div>
                            <div class="example-solution">
                                a = 24, d = -3, S‚Çô = 78<br>
                                78 = n/2[48 + (n-1)(-3)]<br>
                                156 = n[51 - 3n]<br>
                                3n¬≤ - 51n + 156 = 0<br>
                                n = 4 or n = 13
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Interactive Calculator Scene -->
            <div class="content-scene" id="calculator-scene">
                <div class="scene-title">Sum Calculator</div>
                <div class="scene-content">
                    <div class="calculator-container">
                        <div class="step-title">Calculate AP Sum</div>
                        <div class="step-description">
                            Enter the known values to calculate the sum:
                        </div>
                        
                        <div class="input-grid">
                            <div class="input-group">
                                <label class="input-label">First term (a)</label>
                                <input type="number" class="input-field" id="sum-a" placeholder="e.g., 5">
                            </div>
                            <div class="input-group">
                                <label class="input-label">Common difference (d)</label>
                                <input type="number" class="input-field" id="sum-d" placeholder="e.g., 3">
                            </div>
                            <div class="input-group">
                                <label class="input-label">Number of terms (n)</label>
                                <input type="number" class="input-field" id="sum-n" placeholder="e.g., 10">
                            </div>
                            <div class="input-group">
                                <label class="input-label">Last term (optional)</label>
                                <input type="number" class="input-field" id="sum-l" placeholder="If known">
                            </div>
                        </div>
                        
                        <button class="calculate-btn" onclick="calculateSum()">Calculate Sum</button>
                        
                        <div id="sum-result" class="result-display"></div>
                    </div>
                </div>
            </div>

            <!-- Applications Scene -->
            <div class="content-scene" id="applications-scene">
                <div class="scene-title">Real-World Applications</div>
                <div class="scene-content">
                    <div class="application-grid" id="applications-grid">
                        <div class="application-card">
                            <div class="app-title">Simple Interest</div>
                            <div class="app-description">
                                Investment of ‚Çπ1000 at 8% simple interest per year.
                                Interest forms AP: 80, 160, 240, ...
                            </div>
                            <div class="app-calculation">
                                30-year total interest:<br>
                                S‚ÇÉ‚ÇÄ = 30/2[2√ó80 + 29√ó80]<br>
                                = 15[160 + 2320] = ‚Çπ37,200
                            </div>
                        </div>
                        
                        <div class="application-card">
                            <div class="app-title">Manufacturing Production</div>
                            <div class="app-description">
                                TV production: 600 sets in year 3, 700 in year 7.
                                Find total production in first 7 years.
                            </div>
                            <div class="app-calculation">
                                a = 550, d = 25<br>
                                S‚Çá = 7/2[1100 + 6√ó25]<br>
                                = 7/2[1250] = 4375 sets
                            </div>
                        </div>
                        
                        <div class="application-card">
                            <div class="app-title">Construction Penalty</div>
                            <div class="app-description">
                                Delay penalty: ‚Çπ200 first day, ‚Çπ250 second day,
                                increasing by ‚Çπ50 daily. 30-day penalty?
                            </div>
                            <div class="app-calculation">
                                a = 200, d = 50, n = 30<br>
                                S‚ÇÉ‚ÇÄ = 30/2[400 + 29√ó50]<br>
                                = 15[1850] = ‚Çπ27,750
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-title">Explore Sum Concepts</div>
            
            <div class="demo-buttons">
                <button class="demo-btn" onclick="showScene('historical-scene', 0)">Gauss Method</button>
                <button class="demo-btn" onclick="showScene('derivation-scene', 1)">Formula Derivation</button>
                <button class="demo-btn" onclick="showScene('examples-scene', 2)">Worked Examples</button>
                <button class="demo-btn" onclick="showScene('calculator-scene', 3)">Sum Calculator</button>
                <button class="demo-btn" onclick="showScene('applications-scene', 4)">Applications</button>
            </div>
        </div>

        <!-- Analysis Panel -->
        <div class="analysis">
            <div class="analysis-title">Learning Progress</div>
            <div class="analysis-content" id="analysis-content">
                Master the sum formulas through historical context, mathematical derivation, and practical applications.
                From Gauss's brilliant insight to modern problem-solving techniques.
            </div>
        </div>
    </div>

    <script>
        // Voice System
        class SumNarrator {
            constructor() {
                this.isEnabled = globalAudioEnabled;
                this.currentUtterance = null;
                this.settings = { rate: 0.9, pitch: 1.0, volume: 0.8 };
                this.isDestroyed = false;
            }

            async speak(text, delay = 0) {
                if (!this.isEnabled || !text || this.isDestroyed) return;
                
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (this.isDestroyed) {
                            resolve();
                            return;
                        }
                        this.stop();
                        const utterance = new SpeechSynthesisUtterance(text);
                        Object.assign(utterance, this.settings);
                        
                        utterance.onend = resolve;
                        utterance.onerror = resolve;
                        
                        this.currentUtterance = utterance;
                        speechSynthesis.speak(utterance);
                    }, delay);
                });
            }

            stop() {
                speechSynthesis.cancel();
                this.currentUtterance = null;
            }

            destroy() {
                this.isDestroyed = true;
                this.stop();
            }
        }

        // Global state
        let globalAudioEnabled = true;
        let currentNarrator = null;
        let isAnimating = false;

        const sceneNarrations = {
            'welcome-scene': 'Welcome to the sum of first n terms of arithmetic progressions! We have two powerful formulas: S-n equals n over 2 times 2a plus n minus 1 times d, and S-n equals n over 2 times a plus l.',
            'historical-scene': 'Let me tell you about young Carl Friedrich Gauss. When his teacher asked the class to sum numbers from 1 to 100, expecting this would keep them busy, Gauss immediately wrote 5050 on his slate. His brilliant insight was to pair numbers: 1 plus 100 equals 101, 2 plus 99 equals 101, and so on. With 50 such pairs, the sum is 50 times 101, which equals 5050. This method revolutionized how we think about arithmetic series.',
            'derivation-scene': 'Now let\'s derive the general formula using Gauss\'s method. We write the sum forward: S equals a plus a plus d plus a plus 2d, and so on. Then we write it backward: S equals a plus n minus 1 times d, plus a plus n minus 2 times d, and so on. Adding these two expressions, we get 2S equals n times 2a plus n minus 1 times d. Therefore, S equals n over 2 times 2a plus n minus 1 times d. We can also write this as S equals n over 2 times a plus l, where l is the last term.',
            'examples-scene': 'Let\'s work through three essential types of sum problems. Example 1: Find the sum of first 22 terms of 8, 3, negative 2, and so on. Here a equals 8, d equals negative 5, and n equals 22. Using our formula, S-22 equals 22 over 2 times 16 plus 21 times negative 5, which gives us negative 979. Example 2 shows reverse calculation: given the sum is 1050 and first term is 10, we find the common difference is 10, so the 20th term is 200. Example 3 demonstrates quadratic solutions: for the sequence 24, 21, 18, the sum of 78 can be achieved with either 4 terms or 13 terms.',
            'calculator-scene': 'Use this interactive calculator to practice sum calculations. Enter the first term, common difference, and number of terms to find the sum instantly. You can also use the last term if it\'s known.',
            'applications-scene': 'Real-world applications show the power of sum formulas. In simple interest calculations, the interest forms an arithmetic progression. For manufacturing, production targets often follow arithmetic patterns. Construction penalties typically increase arithmetically. These formulas help solve complex business and financial problems efficiently.'
        };

        function createNewNarrator() {
            if (currentNarrator) {
                currentNarrator.destroy();
            }
            currentNarrator = new SumNarrator();
            return currentNarrator;
        }

        function showScene(sceneId, buttonIndex = -1) {
            if (isAnimating) return;
            
            // Hide all scenes
            document.querySelectorAll('.content-scene').forEach(scene => {
                scene.classList.remove('visible');
            });
            
            // Show selected scene
            document.getElementById(sceneId).classList.add('visible');
            
            // Update active button
            if (buttonIndex >= 0) {
                document.querySelectorAll('.demo-btn').forEach((btn, index) => {
                    btn.classList.toggle('active', index === buttonIndex);
                });
            }

            // Trigger animations for the scene
            setTimeout(() => {
                animateSceneContent(sceneId);
            }, 100);

            // Narrate content
            const narrator = createNewNarrator();
            if (sceneNarrations[sceneId]) {
                narrator.speak(sceneNarrations[sceneId]);
            }

            updateAnalysis(sceneId);
        }

        function animateSceneContent(sceneId) {
            const scene = document.getElementById(sceneId);
            
            // Animate step containers
            const stepContainers = scene.querySelectorAll('.step-container');
            stepContainers.forEach((container, index) => {
                setTimeout(() => {
                    container.classList.add('visible');
                }, index * 300);
            });

            // Animate Gauss demonstration
            if (sceneId === 'historical-scene') {
                const forwardBoxes = document.querySelectorAll('#forward-sequence .number-box');
                const reverseBoxes = document.querySelectorAll('#reverse-sequence .number-box');
                
                forwardBoxes.forEach((box, index) => {
                    setTimeout(() => {
                        box.classList.add('visible');
                    }, 1000 + (index * 100));
                });
                
                reverseBoxes.forEach((box, index) => {
                    setTimeout(() => {
                        box.classList.add('visible');
                    }, 1500 + (index * 100));
                });
                
                setTimeout(() => {
                    forwardBoxes.forEach(box => box.classList.add('paired'));
                    reverseBoxes.forEach(box => box.classList.add('paired'));
                }, 2500);
            }

            // Animate derivation steps
            if (sceneId === 'derivation-scene') {
                const derivationSteps = scene.querySelectorAll('.derivation-step');
                derivationSteps.forEach((step, index) => {
                    setTimeout(() => {
                        step.classList.add('visible');
                    }, 500 + (index * 400));
                });
            }

            // Animate example boxes
            const exampleBoxes = scene.querySelectorAll('.example-box');
            exampleBoxes.forEach((box, index) => {
                setTimeout(() => {
                    box.classList.add('visible');
                }, 300 + (index * 200));
            });

            // Animate application cards
            const appCards = scene.querySelectorAll('.application-card');
            appCards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('visible');
                }, 300 + (index * 200));
            });
        }

        function calculateSum() {
            const a = parseFloat(document.getElementById('sum-a').value);
            const d = parseFloat(document.getElementById('sum-d').value);
            const n = parseFloat(document.getElementById('sum-n').value);
            const l = parseFloat(document.getElementById('sum-l').value);

            const resultDiv = document.getElementById('sum-result');

            if (isNaN(a) || isNaN(n)) {
                showResult('Please enter at least the first term (a) and number of terms (n)', 'error');
                return;
            }

            let sum;
            let method;
            const narrator = createNewNarrator();

            // Use the appropriate formula
            if (!isNaN(l)) {
                // Use Sn = n/2(a + l)
                sum = (n / 2) * (a + l);
                method = `Using S‚Çô = n/2(a + l): ${n}/2(${a} + ${l}) = ${sum}`;
                narrator.speak(`Using the first and last term formula, the sum is ${sum}`);
            } else if (!isNaN(d)) {
                // Use Sn = n/2[2a + (n-1)d]
                sum = (n / 2) * (2 * a + (n - 1) * d);
                method = `Using S‚Çô = n/2[2a + (n-1)d]: ${n}/2[2√ó${a} + ${n-1}√ó${d}] = ${sum}`;
                narrator.speak(`Using the standard formula, the sum is ${sum}`);
            } else {
                showResult('Please enter either the common difference (d) or the last term (l)', 'error');
                return;
            }

            showResult(`Sum = ${sum}\n${method}`, 'success');
        }

        function showResult(message, type) {
            const resultDiv = document.getElementById('sum-result');
            resultDiv.textContent = message;
            resultDiv.className = `result-display ${type}`;
            resultDiv.style.display = 'block';
        }

        function updateAnalysis(sceneId) {
            const analysisTexts = {
                'welcome-scene': 'Master the sum formulas through historical context, mathematical derivation, and practical applications. From Gauss\'s brilliant insight to modern problem-solving techniques.',
                'historical-scene': 'Gauss\'s pairing method at age 10 led to the fundamental insight for summing arithmetic progressions. This technique scales to any arithmetic sequence.',
                'derivation-scene': 'The two sum formulas provide flexibility: use the standard form when you know a, d, and n, or the simplified form when you know the first and last terms.',
                'examples-scene': 'Three key problem types: direct sum calculation, finding terms from known sums, and solving for the number of terms using quadratic equations.',
                'calculator-scene': 'Interactive practice helps solidify understanding of both sum formulas and their appropriate applications in different scenarios.',
                'applications-scene': 'Sum formulas solve real problems in finance, manufacturing, and business. These applications demonstrate the practical value of mathematical concepts.'
            };
            
            document.getElementById('analysis-content').textContent = analysisTexts[sceneId] || analysisTexts['welcome-scene'];
        }

        // Initialize
        window.addEventListener('load', () => {
            const narrator = createNewNarrator();
            narrator.speak('Welcome to sum of first n terms of arithmetic progressions! Discover how Gauss\'s brilliant method led to powerful mathematical formulas.');
            updateAnalysis('welcome-scene');
        });

        // Audio Control
        document.getElementById('mute-btn').addEventListener('click', () => {
            globalAudioEnabled = !globalAudioEnabled;
            if (currentNarrator) {
                currentNarrator.isEnabled = globalAudioEnabled;
                if (!globalAudioEnabled) {
                    currentNarrator.stop();
                }
            }
            document.getElementById('mute-btn').classList.toggle('muted', !globalAudioEnabled);
        });
    </script>
</body>
</html>